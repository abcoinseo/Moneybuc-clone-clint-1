<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnFlux - Professional Earning Platform</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='9809601' data-sdk='show_9809601'></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #3b82f6;
            --primary-dark: #2563eb;
            --primary-light: #60a5fa;
            --accent-blue: #0ea5e9;
            --background-dark: #0a0a0a;
            --surface-dark: #18181b;
            --surface-dark-alt: #27272a;
            --border-color: #3f3f46;
            --text-primary: #ffffff;
            --text-secondary: #d4d4d8;
            --text-muted: #71717a;
            --success: #10b981;
            --danger: #dc2626;
            --warning: #f59e0b;
            --info: #0284c7;
            --glass-backdrop-filter: blur(25px);
            --glass-overlay-dark: rgba(24, 24, 27, 0.7);
            --glass-border: rgba(63, 63, 70, 0.5);
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--background-dark);
            color: var(--text-primary);
            overflow-x: hidden;
            position: relative;
            line-height: 1.6;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(circle at 20% 80%, rgba(59, 130, 246, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(96, 165, 250, 0.15) 0%, transparent 50%),
                radial-gradient(circle at 40% 40%, rgba(37, 99, 235, 0.1) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
            animation: subtleGradients 15s ease infinite alternate;
        }

        @keyframes subtleGradients {
            0% { opacity: 0.8; }
            50% { opacity: 1; }
            100% { opacity: 0.8; }
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px 20px 100px;
            position: relative;
        }

        .header {
            background: var(--glass-overlay-dark);
            backdrop-filter: var(--glass-backdrop-filter);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 25px 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.4);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .header:hover {
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.03), transparent);
            animation: shimmer 4s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
            z-index: 1;
        }

        .user-avatar {
            width: 56px;
            height: 56px;
            border-radius: 50%;
            border: 2px solid var(--primary);
            object-fit: cover;
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.3);
        }

        .user-details h3 {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.15rem;
            margin-bottom: 5px;
        }

        .user-balance {
            color: var(--primary);
            font-weight: 700;
            font-size: 1.2rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .theme-toggle {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: white;
            border: none;
            border-radius: 50px;
            padding: 12px 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
            z-index: 1;
            box-shadow: 0 5px 15px rgba(59, 130, 246, 0.3);
        }

        .theme-toggle:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(59, 130, 246, 0.4);
        }

        .card {
            background: var(--surface-dark);
            backdrop-filter: var(--glass-backdrop-filter);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 25px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 2px;
            background: linear-gradient(90deg, var(--primary), var(--primary-light), var(--primary));
            opacity: 0.8;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .card-title {
            font-size: 1.4rem;
            font-weight: 700;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--text-primary);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--surface-dark-alt);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .stat-card:hover::before {
            opacity: 1;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: inset 0 0 10px rgba(0,0,0,0.2), 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        .stat-number {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 10px;
            letter-spacing: -1px;
        }

        .stat-label {
            color: var(--text-secondary);
            font-weight: 500;
            font-size: 0.9rem;
        }

        .btn {
            padding: 14px 28px;
            border: none;
            border-radius: 14px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
            text-decoration: none;
            font-size: 1rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            box-shadow: none;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.6s;
        }

        .btn:hover:not(:disabled)::before {
            left: 100%;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--text-primary);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #047857);
            color: var(--text-primary);
        }

        .btn-success:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(16, 185, 121, 0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #b45309);
            color: var(--text-primary);
        }

        .btn-warning:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(245, 158, 11, 0.4);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #b91c1c);
            color: var(--text-primary);
        }

        .btn-danger:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(220, 38, 38, 0.4);
        }

        .btn-secondary {
            background: var(--surface-dark);
            color: var(--text-secondary);
            border: 1px solid var(--border-color);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary:hover:not(:disabled) {
            transform: translateY(-3px);
            background: var(--surface-dark-alt);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.3);
        }

        /* Professional Spin Wheel */
        .spin-wheel-container {
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            margin: 40px 0;
        }

        .spin-wheel {
            width: 300px;
            height: 300px;
            border-radius: 50%;
            border: 8px solid var(--primary);
            margin: 30px auto;
            position: relative;
            background: conic-gradient(
                from 0deg,
                #ff6b6b 0deg 60deg,    /* Red - 500 points */
                #4ecdc4 60deg 120deg,  /* Teal - 100 points */
                #45b7d1 120deg 180deg, /* Blue - 200 points */
                #96ceb4 180deg 240deg, /* Green - 300 points */
                #feca57 240deg 300deg, /* Yellow - 400 points */
                #ff9ff3 300deg 360deg  /* Pink - 600 points */
            );
            transition: transform 4s cubic-bezier(0.23, 1, 0.32, 1);
            box-shadow: 
                0 0 50px rgba(59, 130, 246, 0.3),
                inset 0 0 30px rgba(0, 0, 0, 0.2);
        }

        .spin-wheel::before {
            content: '';
            position: absolute;
            top: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 40px solid var(--text-primary);
            z-index: 10;
            filter: drop-shadow(0 5px 10px rgba(0, 0, 0, 0.3));
        }

        .spin-center {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80px;
            height: 80px;
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 700;
            font-size: 1.1rem;
            z-index: 5;
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.5);
            border: 4px solid white;
        }

        /* Wheel segments labels */
        .wheel-segment {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 0.9rem;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            pointer-events: none;
        }

        .segment-1 { transform: rotate(30deg); }
        .segment-2 { transform: rotate(90deg); }
        .segment-3 { transform: rotate(150deg); }
        .segment-4 { transform: rotate(210deg); }
        .segment-5 { transform: rotate(270deg); }
        .segment-6 { transform: rotate(330deg); }

        .segment-text {
            position: absolute;
            top: 30px;
            transform: rotate(-30deg);
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: var(--surface-dark);
            backdrop-filter: blur(20px);
            border-top: 1px solid var(--border-color);
            padding: 15px 0;
            z-index: 1000;
            box-shadow: 0 -5px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            max-width: 500px;
            margin: 0 auto;
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
            text-decoration: none;
            color: var(--text-muted);
            transition: all 0.3s ease;
            padding: 8px 12px;
            border-radius: 12px;
            position: relative;
        }

        .nav-item.active, .nav-item:hover {
            color: var(--primary);
            background: rgba(59, 130, 246, 0.1);
        }

        .nav-item span {
            font-size: 0.8rem;
            font-weight: 600;
        }

        .section {
            display: none;
        }

        .section.active {
            display: block;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            z-index: 2000;
            backdrop-filter: blur(15px);
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--surface-dark);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 35px;
            max-width: 450px;
            width: 100%;
            max-height: 85vh;
            overflow-y: auto;
            box-shadow: 0 15px 50px rgba(0, 0, 0, 0.5);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .modal-title {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--primary);
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-muted);
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            color: var(--text-secondary);
            transform: scale(1.1);
        }

        /* Ban Modal */
        .ban-modal {
            background: linear-gradient(135deg, var(--danger), #b91c1c);
            color: white;
            text-align: center;
        }

        .ban-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: shake 0.5s ease-in-out infinite alternate;
        }

        @keyframes shake {
            0% { transform: translateX(-5px); }
            100% { transform: translateX(5px); }
        }

        /* Form styles */
        .form-group {
            margin-bottom: 25px;
        }

        .form-label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .form-input {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: var(--surface-dark-alt);
            color: var(--text-primary);
            outline: none;
        }

        .form-input:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.15);
        }

        /* Ad countdown */
        .ad-countdown-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            backdrop-filter: blur(10px);
        }

        .ad-countdown-content {
            text-align: center;
            padding: 40px;
            background: var(--surface-dark);
            border-radius: 20px;
            border: 2px solid var(--primary);
        }

        .ad-timer {
            font-size: 4rem;
            font-weight: 900;
            color: var(--primary);
            margin-bottom: 20px;
        }

        .ad-progress {
            width: 300px;
            height: 10px;
            background: var(--surface-dark-alt);
            border-radius: 5px;
            overflow: hidden;
            margin: 20px auto;
        }

        .ad-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--primary-light));
            border-radius: 5px;
            transition: width 0.1s ease;
        }

        /* Loading */
        .loading {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 4px solid rgba(255, 255, 255, .3);
            border-radius: 50%;
            border-top-color: var(--text-primary);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Alerts */
        .alert {
            padding: 18px 25px;
            border-radius: 14px;
            margin-bottom: 25px;
            border-left: 5px solid;
            display: flex;
            align-items: center;
            gap: 15px;
            animation: slideIn 0.4s ease-out;
            position: relative;
            z-index: 1001;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
        }

        @keyframes slideIn {
            from {
                transform: translateX(-100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .alert-success { background: rgba(16, 185, 121, 0.1); border-left-color: var(--success); color: var(--success); }
        .alert-danger { background: rgba(220, 38, 38, 0.1); border-left-color: var(--danger); color: var(--danger); }
        .alert-warning { background: rgba(217, 119, 6, 0.1); border-left-color: var(--warning); color: var(--warning); }
        .alert-info { background: rgba(2, 132, 199, 0.1); border-left-color: var(--info); color: var(--info); }

        /* Pulse animation */
        .pulse {
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            70% {
                box-shadow: 0 0 0 12px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }

        .glow {
            box-shadow: 0 0 25px rgba(59, 130, 246, 0.5);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .container {
                padding: 15px 10px 100px;
            }

            .header {
                flex-direction: column;
                gap: 15px;
                text-align: center;
                border-radius: 16px;
                padding: 20px;
            }

            .user-info {
                flex-direction: column;
                gap: 8px;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
                gap: 15px;
            }

            .spin-wheel {
                width: 250px;
                height: 250px;
            }

            .modal-content {
                width: 95%;
                padding: 25px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="user-info">
                <img src="https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&dpr=1" alt="User Avatar" class="user-avatar" id="userAvatar">
                <div class="user-details">
                    <h3 id="userName">Loading...</h3>
                    <div class="user-balance">
                        <span class="material-icons">diamond</span>
                        <span id="userBalance">0</span> Diamond
                    </div>
                </div>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">
                <span class="material-icons">dark_mode</span>
                Professional Theme
            </button>
        </div>

        <!-- Stats Grid -->
        <div id="homeStatsGrid" class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalEarned">0</div>
                <div class="stat-label">Total Earned</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="tasksCompleted">0</div>
                <div class="stat-label">Tasks Done</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="referrals">0</div>
                <div class="stat-label">Referrals</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="spinsAvailable">0</div>
                <div class="stat-label">Spins Left</div>
            </div>
        </div>

        <!-- Home Section -->
        <div id="homeSection" class="section active">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">home</span>
                    Welcome to EarnFlux Pro
                </h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="showSection('ads')">
                        <span class="material-icons">play_circle</span>
                        Watch Ads
                    </button>
                    <button class="btn btn-warning" onclick="showSection('spin')">
                        <span class="material-icons">casino</span>
                        Spin Wheel
                    </button>
                    <button class="btn btn-success" onclick="dailyCheckin()" id="dailyCheckinBtn">
                        <span class="material-icons">event_available</span>
                        Daily Check-in
                    </button>
                </div>
            </div>
        </div>

        <!-- Ads Section -->
        <div id="adsSection" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">play_circle</span>
                    Watch Ads - Professional System
                </h2>
                <div style="text-align: center;">
                    <p style="margin-bottom: 20px; color: var(--text-secondary);">
                        Daily Limit: <span id="adsWatched">0</span>/50 | Must watch full 15 seconds for reward
                    </p>
                    <button class="btn btn-primary pulse glow" id="watchAdButton" onclick="watchAd()">
                        <span class="material-icons">play_arrow</span>
                        Watch Ad (+10 Diamond)
                    </button>
                    <p id="adCooldownMessage" style="margin-top: 15px; color: var(--text-secondary); font-size: 0.9rem;"></p>
                </div>
            </div>
        </div>

        <!-- Spin Section -->
        <div id="spinSection" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">casino</span>
                    Professional Spin Wheel
                </h2>
                <div style="text-align: center;">
                    <div class="spin-wheel-container">
                        <div class="spin-wheel" id="spinWheel">
                            <div class="wheel-segment segment-1">
                                <div class="segment-text">500</div>
                            </div>
                            <div class="wheel-segment segment-2">
                                <div class="segment-text">100</div>
                            </div>
                            <div class="wheel-segment segment-3">
                                <div class="segment-text">200</div>
                            </div>
                            <div class="wheel-segment segment-4">
                                <div class="segment-text">300</div>
                            </div>
                            <div class="wheel-segment segment-5">
                                <div class="segment-text">400</div>
                            </div>
                            <div class="wheel-segment segment-6">
                                <div class="segment-text">600</div>
                            </div>
                            <div class="spin-center">SPIN</div>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="spinButton" onclick="spinWheel()">
                        <span class="material-icons">casino</span>
                        Spin Now
                    </button>
                    <p style="margin-top: 15px; color: var(--text-secondary);">
                        Spins Available: <span id="spinsCount">0</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profileSection" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">account_balance_wallet</span>
                    Withdraw System
                </h2>
                <div style="text-align: center; margin-bottom: 20px;">
                    <img src="https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&dpr=1" alt="Profile" class="user-avatar" style="width: 100px; height: 100px;" id="profileAvatar">
                    <h3 style="margin: 15px 0; color: var(--text-primary);" id="profileName">Loading...</h3>
                    <div style="font-size: 1.5rem; color: var(--primary); font-weight: 700;">
                        Balance: <span id="profileBalance">0</span> Diamond
                    </div>
                </div>
                
                <button class="btn btn-primary" onclick="showWithdrawModal()" style="width: 100%; margin-bottom: 20px;">
                    <span class="material-icons">send</span>
                    Request Withdrawal
                </button>
                
                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center;">
                    <button class="btn btn-secondary" onclick="window.open('https://t.me/onlineearnmonnytrickszin', '_blank')">
                        <span class="material-icons">support</span>
                        Support
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-container">
            <a href="#" class="nav-item active" onclick="showSection('home'); return false;">
                <span class="material-icons">home</span>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" onclick="showSection('ads'); return false;">
                <span class="material-icons">play_circle</span>
                <span>Ads</span>
            </a>
            <a href="#" class="nav-item" onclick="showSection('spin'); return false;">
                <span class="material-icons">casino</span>
                <span>Spin</span>
            </a>
            <a href="#" class="nav-item" onclick="showSection('profile'); return false;">
                <span class="material-icons">account_balance_wallet</span>
                <span>Profile</span>
            </a>
        </div>
    </div>

    <!-- Ad Countdown Overlay -->
    <div id="adCountdownOverlay" class="ad-countdown-overlay">
        <div class="ad-countdown-content">
            <div class="ad-timer" id="adTimer">15</div>
            <div>Watch the full ad to earn rewards</div>
            <div class="ad-progress">
                <div class="ad-progress-fill" id="adProgressFill"></div>
            </div>
            <button class="btn btn-danger" onclick="closeAd()" id="closeAdBtn" style="margin-top: 20px; display: none;">
                Close Ad
            </button>
        </div>
    </div>

    <!-- Ban Modal -->
    <div id="banModal" class="modal">
        <div class="modal-content ban-modal">
            <div class="ban-icon">
                <span class="material-icons">block</span>
            </div>
            <h2>Account Banned</h2>
            <p style="margin: 20px 0; font-size: 1.1rem;">
                You are banned from using our app due to multiple account detection from same IP/device.
            </p>
            <p style="margin: 20px 0;">
                Please contact support for assistance:
            </p>
            <button class="btn btn-secondary" onclick="window.open('https://t.me/onlineearnmonnytrickszin', '_blank')" style="background: white; color: var(--danger); border: none;">
                <span class="material-icons">support</span>
                Contact Support
            </button>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <div id="withdrawModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Withdraw Request</h3>
                <button class="close-btn" onclick="closeModal('withdrawModal')">&times;</button>
            </div>
            <form id="withdrawForm">
                <div class="form-group">
                    <label class="form-label">Wallet Address (Auto-detected)</label>
                    <input type="text" class="form-input" id="withdrawAddress" readonly>
                    <small style="color: var(--text-muted); font-size: 12px;">
                        Supports UQ, EQ, 0: and other TON address formats
                    </small>
                </div>
                <div class="form-group">
                    <label class="form-label">Amount (Diamond)</label>
                    <input type="number" class="form-input" id="withdrawAmount" min="1000" required placeholder="Minimum 1000 Diamond">
                </div>
                <button type="submit" class="btn btn-primary" id="withdrawSubmitBtn">
                    <span class="material-icons">send</span>
                    Submit Request
                </button>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA3SqCHzN3kLj7DC8Cyu9OzxPFtIlyyii4",
            authDomain: "maneybux-clone.firebaseapp.com",
            databaseURL: "https://maneybux-clone-default-rtdb.firebaseio.com",
            projectId: "maneybux-clone",
            storageBucket: "maneybux-clone.firebasestorage.app",
            messagingSenderId: "153207109623",
            appId: "1:153207109623:web:4cd48633c49c2ba3c1a0f2"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Global variables
        let currentUser = null;
        let userBalance = 0;
        let userSpins = 0;
        let adsWatchedToday = 0;
        let userBanned = false;
        let userIP = '';
        let deviceFingerprint = '';
        let adWatchStartTime = 0;
        let adTimer = null;
        let adDuration = 15; // 15 seconds required
        let currentAdTime = 0;

        // Constants
        const AD_REWARD_POINTS = 10;
        const CHECKIN_REWARD_POINTS = 20;
        const MIN_WITHDRAW_AMOUNT = 1000;
        const MAX_DAILY_ADS = 50;
        const SPIN_REWARDS = [500, 100, 200, 300, 400, 600];

        // Device fingerprinting and IP detection
        async function generateDeviceFingerprint() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('EarnFlux Fingerprint', 2, 2);
            const canvasFingerprint = canvas.toDataURL();

            const fingerprint = btoa(JSON.stringify({
                userAgent: navigator.userAgent,
                language: navigator.language,
                platform: navigator.platform,
                screen: `${screen.width}x${screen.height}x${screen.colorDepth}`,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                canvas: canvasFingerprint.substring(0, 100),
                webgl: getWebGLFingerprint(),
                plugins: Array.from(navigator.plugins).map(p => p.name).join(','),
                hardwareConcurrency: navigator.hardwareConcurrency || 'unknown'
            }));

            return fingerprint;
        }

        function getWebGLFingerprint() {
            const gl = document.createElement('canvas').getContext('webgl');
            if (!gl) return 'no-webgl';
            
            const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
            const vendor = debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : '';
            const renderer = debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : '';
            
            return `${vendor}~${renderer}`;
        }

        // Get user IP address
        async function getUserIP() {
            try {
                const response = await fetch('https://api.ipify.org?format=json');
                const data = await response.json();
                return data.ip;
            } catch (error) {
                console.error('Error getting IP:', error);
                return 'unknown';
            }
        }

        // Multi-account detection and banning system
        async function checkMultiAccount(userId, ip, fingerprint) {
            try {
                const accountsRef = database.ref('accounts');
                const snapshot = await accountsRef.once('value');
                const accounts = snapshot.val() || {};
                
                const existingAccount = Object.values(accounts).find(account => 
                    account.ip === ip && account.userId !== userId
                );
                
                if (existingAccount) {
                    // Ban both accounts
                    await database.ref(`accounts/${userId}`).update({ banned: true, banReason: 'Multi-account detected', banDate: Date.now() });
                    await database.ref(`accounts/${existingAccount.userId}`).update({ banned: true, banReason: 'Multi-account detected', banDate: Date.now() });
                    
                    return true; // User is banned
                }
                
                // Save/update account info
                await database.ref(`accounts/${userId}`).set({
                    userId: userId,
                    ip: ip,
                    fingerprint: fingerprint,
                    lastActive: Date.now(),
                    banned: false,
                    created: Date.now()
                });
                
                return false; // User is not banned
            } catch (error) {
                console.error('Error checking multi-account:', error);
                return false;
            }
        }

        // Check if user is banned
        async function checkBanStatus(userId) {
            try {
                const accountRef = database.ref(`accounts/${userId}`);
                const snapshot = await accountRef.once('value');
                const accountData = snapshot.val();
                
                return accountData ? accountData.banned === true : false;
            } catch (error) {
                console.error('Error checking ban status:', error);
                return false;
            }
        }

        // Show ban modal
        function showBanModal() {
            document.getElementById('banModal').style.display = 'flex';
            // Hide all other content
            document.querySelector('.container').style.display = 'none';
            document.querySelector('.bottom-nav').style.display = 'none';
        }

        // Initialize Telegram Web App
        async function initTelegramWebApp() {
            try {
                userIP = await getUserIP();
                deviceFingerprint = await generateDeviceFingerprint();

                if (window.Telegram && window.Telegram.WebApp) {
                    const tg = window.Telegram.WebApp;
                    tg.ready();
                    tg.expand();

                    const user = tg.initDataUnsafe?.user;
                    if (user) {
                        currentUser = {
                            id: user.id,
                            username: user.username || '',
                            first_name: user.first_name || 'User',
                            photo_url: user.photo_url || 'https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&dpr=1'
                        };
                    } else {
                        // Fallback for testing
                        currentUser = {
                            id: Math.floor(Math.random() * 1000000000) + 9000000000,
                            username: 'testuser',
                            first_name: 'Test User',
                            photo_url: 'https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&dpr=1'
                        };
                    }

                    // Check for ban and multi-account
                    const isBanned = await checkBanStatus(currentUser.id);
                    if (isBanned) {
                        showBanModal();
                        return;
                    }

                    const isMultiAccount = await checkMultiAccount(currentUser.id, userIP, deviceFingerprint);
                    if (isMultiAccount) {
                        showBanModal();
                        return;
                    }

                    initializeUser();
                } else {
                    showAlert('Please open this app through Telegram', 'danger');
                }
            } catch (error) {
                console.error('Initialization error:', error);
                showAlert('Failed to initialize app', 'danger');
            }
        }

        // Initialize user data
        async function initializeUser() {
            if (!currentUser) return;

            const userRef = database.ref('users/' + currentUser.id);
            
            try {
                const snapshot = await userRef.once('value');
                
                if (!snapshot.exists()) {
                    const userData = {
                        id: currentUser.id,
                        username: currentUser.username,
                        first_name: currentUser.first_name,
                        photo_url: currentUser.photo_url,
                        balance: 0,
                        spins: 3, // Starting spins
                        totalEarned: 0,
                        tasksCompleted: 0,
                        referrals: 0,
                        adsWatched: 0,
                        lastAdReset: Date.now(),
                        lastCheckin: null,
                        createdAt: Date.now()
                    };
                    await userRef.set(userData);
                }

                // Set up real-time listener
                userRef.on('value', (snapshot) => {
                    const userData = snapshot.val();
                    if (userData) {
                        userBalance = userData.balance || 0;
                        userSpins = userData.spins || 0;
                        adsWatchedToday = userData.adsWatched || 0;

                        // Reset daily ad count if 24 hours have passed
                        if (Date.now() - (userData.lastAdReset || 0) > 24 * 60 * 60 * 1000) {
                            adsWatchedToday = 0;
                            userRef.update({
                                adsWatched: 0,
                                lastAdReset: Date.now()
                            });
                        }

                        updateUI(userData);
                        updateAdButtonState();
                    }
                });

            } catch (error) {
                console.error('Error initializing user:', error);
                showAlert('Failed to load user data', 'danger');
            }
        }

        // Update UI elements
        function updateUI(userData) {
            document.getElementById('userName').textContent = userData.first_name || 'User';
            document.getElementById('userBalance').textContent = formatNumber(userData.balance || 0);
            document.getElementById('profileBalance').textContent = formatNumber(userData.balance || 0);
            document.getElementById('totalEarned').textContent = formatNumber(userData.totalEarned || 0);
            document.getElementById('tasksCompleted').textContent = formatNumber(userData.tasksCompleted || 0);
            document.getElementById('referrals').textContent = formatNumber(userData.referrals || 0);
            document.getElementById('spinsAvailable').textContent = userData.spins || 0;
            document.getElementById('spinsCount').textContent = userData.spins || 0;
            document.getElementById('adsWatched').textContent = adsWatchedToday;

            if (userData.photo_url) {
                document.getElementById('userAvatar').src = userData.photo_url;
                document.getElementById('profileAvatar').src = userData.photo_url;
            }

            document.getElementById('profileName').textContent = userData.first_name || 'User';

            // Update daily checkin button
            const dailyCheckinBtn = document.getElementById('dailyCheckinBtn');
            const today = new Date().toDateString();
            if (userData.lastCheckin === today) {
                dailyCheckinBtn.innerHTML = '<span class="material-icons">check_circle</span> Checked In Today!';
                dailyCheckinBtn.disabled = true;
                dailyCheckinBtn.classList.remove('btn-success');
                dailyCheckinBtn.classList.add('btn-secondary');
            }
        }

        // Professional ad watching system with 15-second requirement
        async function watchAd() {
            if (adsWatchedToday >= MAX_DAILY_ADS) {
                showAlert('Daily ad limit reached. Come back tomorrow!', 'warning');
                return;
            }

            if (typeof show_9809601 !== 'function') {
                showAlert('Ad service is temporarily unavailable', 'warning');
                return;
            }

            // Show countdown overlay
            document.getElementById('adCountdownOverlay').style.display = 'flex';
            
            currentAdTime = 0;
            adWatchStartTime = Date.now();
            
            const timerElement = document.getElementById('adTimer');
            const progressFill = document.getElementById('adProgressFill');
            const closeBtn = document.getElementById('closeAdBtn');

            // Start the ad
            try {
                // Start countdown timer
                adTimer = setInterval(() => {
                    currentAdTime++;
                    const remaining = adDuration - currentAdTime;
                    timerElement.textContent = remaining;
                    
                    const progress = (currentAdTime / adDuration) * 100;
                    progressFill.style.width = progress + '%';

                    if (currentAdTime >= adDuration) {
                        clearInterval(adTimer);
                        timerElement.textContent = '✓';
                        closeBtn.style.display = 'block';
                        closeBtn.textContent = 'Claim Reward';
                        closeBtn.className = 'btn btn-success';
                        closeBtn.onclick = () => claimAdReward();
                    }
                }, 1000);

                // Show the actual ad
                await show_9809601();

            } catch (error) {
                console.error('Ad error:', error);
                closeAd();
                showAlert('Ad was closed early. No reward given.', 'warning');
            }
        }

        // Close ad (early close, no reward)
        function closeAd() {
            if (adTimer) {
                clearInterval(adTimer);
                adTimer = null;
            }
            
            document.getElementById('adCountdownOverlay').style.display = 'none';
            
            // Reset UI
            document.getElementById('adTimer').textContent = '15';
            document.getElementById('adProgressFill').style.width = '0%';
            document.getElementById('closeAdBtn').style.display = 'none';
            document.getElementById('closeAdBtn').className = 'btn btn-danger';
            document.getElementById('closeAdBtn').textContent = 'Close Ad';
            document.getElementById('closeAdBtn').onclick = () => closeAd();
            
            currentAdTime = 0;
        }

        // Claim ad reward (only after 15 seconds)
        async function claimAdReward() {
            if (currentAdTime < adDuration) {
                showAlert('You must watch the full ad to earn rewards!', 'warning');
                return;
            }

            try {
                const userRef = database.ref('users/' + currentUser.id);
                await userRef.transaction((userData) => {
                    if (userData) {
                        userData.balance = (userData.balance || 0) + AD_REWARD_POINTS;
                        userData.totalEarned = (userData.totalEarned || 0) + AD_REWARD_POINTS;
                        userData.adsWatched = (userData.adsWatched || 0) + 1;
                    }
                    return userData;
                });

                closeAd();
                showAlert(`Congratulations! You earned ${AD_REWARD_POINTS} Diamond!`, 'success');
                adsWatchedToday++;
                updateAdButtonState();

            } catch (error) {
                console.error('Error claiming ad reward:', error);
                showAlert('Failed to claim reward. Please try again.', 'danger');
            }
        }

        // Update ad button state
        function updateAdButtonState() {
            const watchAdButton = document.getElementById('watchAdButton');
            const cooldownMessage = document.getElementById('adCooldownMessage');

            if (adsWatchedToday >= MAX_DAILY_ADS) {
                watchAdButton.disabled = true;
                watchAdButton.innerHTML = '<span class="material-icons">block</span> Daily Limit Reached';
                watchAdButton.classList.remove('pulse', 'glow');
                cooldownMessage.textContent = 'Come back tomorrow for more ads!';
            } else {
                watchAdButton.disabled = false;
                watchAdButton.innerHTML = '<span class="material-icons">play_arrow</span> Watch Ad (+10 Diamond)';
                watchAdButton.classList.add('pulse', 'glow');
                cooldownMessage.textContent = `${MAX_DAILY_ADS - adsWatchedToday} ads remaining today`;
            }
        }

        // Daily check-in with Telegram redirect
        async function dailyCheckin() {
            // Open Telegram channel
            window.open('https://t.me/onlineearnmonnytrickszin', '_blank');
            
            const today = new Date().toDateString();
            const userRef = database.ref('users/' + currentUser.id);
            
            try {
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();

                if (userData.lastCheckin === today) {
                    showAlert('You have already checked in today!', 'warning');
                    return;
                }

                await userRef.update({
                    balance: (userData.balance || 0) + CHECKIN_REWARD_POINTS,
                    totalEarned: (userData.totalEarned || 0) + CHECKIN_REWARD_POINTS,
                    lastCheckin: today
                });

                showAlert(`Daily check-in completed! You earned ${CHECKIN_REWARD_POINTS} Diamond! Thank you for joining our channel!`, 'success');

            } catch (error) {
                console.error('Error during daily check-in:', error);
                showAlert('Check-in failed. Please try again.', 'danger');
            }
        }

        // Professional spin wheel
        function spinWheel() {
            if (userSpins <= 0) {
                showAlert('No spins available! Complete tasks to earn spins.', 'warning');
                return;
            }

            const spinButton = document.getElementById('spinButton');
            const wheel = document.getElementById('spinWheel');

            spinButton.disabled = true;
            
            // Random spin with realistic physics
            const spins = Math.floor(Math.random() * 4) + 8; // 8-11 full rotations
            const finalAngle = Math.floor(Math.random() * 360);
            const totalRotation = (spins * 360) + finalAngle;

            wheel.style.transform = `rotate(${totalRotation}deg)`;

            setTimeout(async () => {
                // Determine reward based on final angle
                const normalizedAngle = finalAngle % 360;
                const segmentIndex = Math.floor(normalizedAngle / 60);
                const reward = SPIN_REWARDS[segmentIndex];

                try {
                    const userRef = database.ref('users/' + currentUser.id);
                    await userRef.transaction((userData) => {
                        if (userData) {
                            userData.balance = (userData.balance || 0) + reward;
                            userData.totalEarned = (userData.totalEarned || 0) + reward;
                            userData.spins = Math.max(0, (userData.spins || 0) - 1);
                        }
                        return userData;
                    });

                    showAlert(`🎉 Amazing! You won ${reward} Diamond!`, 'success');

                } catch (error) {
                    console.error('Error updating balance after spin:', error);
                    showAlert('Spin failed. Please try again.', 'danger');
                } finally {
                    spinButton.disabled = false;
                }
            }, 4000);
        }

        // Show withdraw modal with auto address detection
        function showWithdrawModal() {
            const modal = document.getElementById('withdrawModal');
            const addressInput = document.getElementById('withdrawAddress');
            
            // Generate a sample address based on common formats
            const addressFormats = [
                'UQDLsNfQBwWXD9aaNxNS3udGo-9o8ybrlKmmbI5gjjRfs17M',
                'EQDLsNfQBwWXD9aaNxNS3udGo-9o8ybrlKmmbI5gjjRfs17M',
                '0:4bb0d7d00705970fd69a37135edee746a3ef68f326eb94a9a66c8e608e345fb35ec'
            ];
            
            const randomAddress = addressFormats[Math.floor(Math.random() * addressFormats.length)];
            addressInput.value = randomAddress;
            
            modal.style.display = 'flex';
        }

        // Handle withdraw form
        document.getElementById('withdrawForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const address = document.getElementById('withdrawAddress').value;
            const amount = parseInt(document.getElementById('withdrawAmount').value);
            
            if (amount < MIN_WITHDRAW_AMOUNT) {
                showAlert(`Minimum withdrawal amount is ${MIN_WITHDRAW_AMOUNT} Diamond`, 'warning');
                return;
            }
            
            if (amount > userBalance) {
                showAlert('Insufficient balance!', 'warning');
                return;
            }
            
            const submitBtn = document.getElementById('withdrawSubmitBtn');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<div class="loading"></div> Processing...';
            
            try {
                // Save withdrawal request
                await database.ref('withdrawals').push({
                    userId: currentUser.id,
                    username: currentUser.username,
                    address: address,
                    amount: amount,
                    status: 'pending',
                    timestamp: Date.now()
                });
                
                // Deduct from user balance
                const userRef = database.ref('users/' + currentUser.id);
                await userRef.transaction((userData) => {
                    if (userData) {
                        userData.balance = Math.max(0, (userData.balance || 0) - amount);
                    }
                    return userData;
                });
                
                closeModal('withdrawModal');
                showAlert('Withdrawal request submitted successfully! Processing may take 24-48 hours.', 'success');
                
            } catch (error) {
                console.error('Withdrawal error:', error);
                showAlert('Failed to process withdrawal. Please try again.', 'danger');
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<span class="material-icons">send</span> Submit Request';
            }
        });

        // Show section
        function showSection(sectionName) {
            document.querySelectorAll('.section').forEach(section => {
                section.style.display = 'none';
            });
            
            const targetSection = document.getElementById(sectionName + 'Section');
            if (targetSection) {
                targetSection.style.display = 'block';
            }
            
            const statsGrid = document.getElementById('homeStatsGrid');
            if (sectionName === 'home') {
                statsGrid.style.display = 'grid';
            } else {
                statsGrid.style.display = 'none';
            }
            
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            const activeNavItem = document.querySelector(`.nav-item[onclick*="showSection('${sectionName}')"]`);
            if (activeNavItem) {
                activeNavItem.classList.add('active');
            }
        }

        // Close modal
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Show alert
        function showAlert(message, type) {
            const alertContainer = document.querySelector('.container');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <span class="material-icons">${type === 'success' ? 'check_circle' : type === 'warning' ? 'warning' : 'error'}</span>
                ${message}
            `;
            alertContainer.prepend(alert);
            
            setTimeout(() => {
                if (alert && alert.parentNode) {
                    alert.remove();
                }
            }, 5000);
        }

        // Format numbers
        function formatNumber(num) {
            if (num >= 1e9) return (num / 1e9).toFixed(1) + 'B';
            if (num >= 1e6) return (num / 1e6).toFixed(1) + 'M';
            if (num >= 1e3) return (num / 1e3).toFixed(1) + 'K';
            return num.toString();
        }

        // Theme toggle
        function toggleTheme() {
            showAlert('Professional Dark Theme is active!', 'info');
        }

        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            initTelegramWebApp();
        });

        // Close modals when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                closeModal(e.target.id);
            }
        });
    </script>
</body>
</html>
