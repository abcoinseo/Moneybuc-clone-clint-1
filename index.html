<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnFlux - Professional Earning Platform</title>
    <link href```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnFlux - Professional Earning Platform</title>
    <link href400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        * {
            margin: 400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://telegram.org/js/telegram-web-app.js"></0;
            padding: 0;
            box-sizing: border-box;
        }


:root {
--primary: #dc2626;
--primary-dark: #b91c1c;
script>
    <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
    <style>
        * {
            margin: --primary-light: #ef4444;
--secondary: #7c2d12;
--accent: #f59e0b;
--success: #059669;
--danger0;
            padding: 0;
            box-sizing: border-box;
        }


:root {
--primary: #dc2626;
--primary-dark: #b91c1: #dc2626;
--warning: #d97706;
--dark: #0f0f23;
--dark-secondary: #1a1a2e;
--c;
--primary-light: #ef4444;
--secondary: #7c2d12;
--accent: #f59e0b;
--success: #0596dark-tertiary: #16213e;
--light: #f8fafc;
--border: #374151;
--text: #f1f5f9;
--text-69;
--danger: #dc2626;
--warning: #d97706;
--dark: #0f0f23;
--dark-secondary: #1a1light: #cbd5e1;
--text-muted: #94a3b8;
--glass: rgba(220, 38, 38, 0.1);
--glassa2e;
--dark-tertiary: #16213e;
--light: #f8fafc;
--border: #374151;
--text: #f1f5f-border: rgba(220, 38, 38, 0.2);
}

body {
font-family: 'Inter', sans-serif;
background: linear-gradient(135deg9;
--text-light: #cbd5e1;
--text-muted: #94a3b8;
--glass: rgba(220, 38, 38, 0, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
min-height: 100vh;
color:.1);
--glass-border: rgba(220, 38, 38, 0.2);
}

body {
font-family: 'Inter', sans-serif;
background: linear var(--text);
overflow-x: hidden;
position: relative;
}

body::before {
content: '';
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background:
radial-gradient(circle at 20% 80%, rgba(220, 38, 38, 0.3) 0%,-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
min-height: 1 transparent 50%),
radial-gradient(circle at 80% 20%, rgba(239, 68, 68, 0.2) 0%, transparent 50%),
radial-00vh;
color: var(--text);
overflow-x: hidden;
position: relative;
}

body::before {
content: '';
position: fixed;
top: 0;
left:gradient(circle at 40% 40%, rgba(185, 28, 28, 0.1) 0%, transparent 50%);
pointer-events: none;
z-index: -1 0;
right: 0;
bottom: 0;
background:
radial-gradient(circle at 20% 80%, rgba(220, 38, 38, ;
}

.container {
max-width: 100%;
margin: 0 auto;
padding: 20px 15px 100px;
position: relative;
}

.header {
background: rgba(15, 15, 35, 0.8);
backdrop-filter: blur(20px);
border: 1px solid var(--glass-border0.3) 0%, transparent 50%),
radial-gradient(circle at 80% 20%, rgba(239, 68, 68, 0.2) 0%, transparent 50%),
radial-gradient(circle at 40% 40%, rgba(185, 28, 28, 0.1) 0%, transparent 50%);
pointer);
border-radius: 20px;
padding: 20px;
margin-bottom: 20px;
box-shadow: 0 8px 32px rgba(220, 38, 38, 0.2);
display: flex;
justify-content: space-between;
align-items: center;
position: relative;
overflow: hidden;
}

.header::before-events: none;
z-index: -1;
}

.container {
max-width: 100%;
margin: 0 auto;
padding: 20px 15px  {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(9100px;
position: relative;
}

.header {
background: rgba(15, 15, 35, 0.8);
backdrop-filter: blur(20px);
border: 1px solid var(--glass-border);
border-radius: 20px;
padding: 20px;
margin-bottom: 20px;
box-shadow: 00deg, transparent, rgba(220, 38, 38, 0.1), transparent);
animation: shimmer 3s infinite;
}

@keyframes shimmer {
0% { left: -100%; }
100% { left: 100%; }
}

.user-info {
display: flex;
align-items: center;
gap: 12px;
z-index: 1 8px 32px rgba(220, 38, 38, 0.2);
display: flex;
justify-content: space-between;
align-items: center;
position: relative;;
}

.user-avatar {
width: 50px;
height: 50px;
border-radius: 50%;
border: 2px solid var(--primary);
object-
overflow: hidden;
}

.header::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: fit: cover;
box-shadow: 0 0 20px rgba(220, 38, 38, 0.3);
}

.user-details h3 {
color100%;
background: linear-gradient(90deg, transparent, rgba(220, 38, 38, 0.1), transparent);
animation: shimmer 3s infinite;
}

@: var(--text);
font-weight: 600;
margin-bottom: 4px;
}

.user-balance {
color: var(--primary);
font-weight: 700keyframes shimmer {
0% { left: -100%; }
100% { left: 100%; }
}

.user-info {
display: flex;
align-items: center;
gap:;
font-size: 18px;
display: flex;
align-items: center;
gap: 5px;
}

.theme-toggle {
background: linear-gradient(135deg, var(--primary), var(--primary-dark));
color: white;
border: none;
border-radius: 50px;
padding: 10px 15px;
cursor: pointer;
display: flex;
align-items 12px;
z-index: 1;
}

.user-avatar {
width: 50px;
height: 50px;
border-radius: 50%;
border: center;
gap: 8px;
transition: all 0.3s ease;
z-index: 1;
}

.theme-toggle:hover {
transform: translateY(-2px);
box-shadow: : 2px solid var(--primary);
object-fit: cover;
box-shadow: 0 0 20px rgba(220, 38, 38, 0.3);
}

.user0 8px 25px rgba(220, 38, 38, 0.4);
}

.card {
background: rgba(15, 15, 35, 0.8-details h3 {
color: var(--text);
font-weight: 600;
margin-bottom: 4px;
}

.user-balance {
color: var(--primary);
font);
backdrop-filter: blur(20px);
border: 1px solid var(--glass-border);
border-radius: 20px;
padding: 24px;
margin-bottom:-weight: 700;
font-size: 18px;
display: flex;
align-items: center;
gap: 5px;
}

.theme-toggle {
background: 20px;
box-shadow: 0 8px 32px rgba(220, 38, 38, 0.15);
transition: all 0.3s linear-gradient(135deg, var(--primary), var(--primary-dark));
color: white;
border: none;
border-radius: 50px;
padding: 10px 15px; ease;
position: relative;
overflow: hidden;
}

.card::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;

cursor: pointer;
display: flex;
align-items: center;
gap: 8px;
transition: all 0.3s ease;
z-index: 1;
}

.themeheight: 2px;
background: linear-gradient(90deg, var(--primary), var(--primary-light), var(--primary));
opacity: 0.7;
}

.card:hover {
transform: translateY-toggle:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
}(-4px);
box-shadow: 0 16px 48px rgba(220, 38, 38, 0.25);
}

.card-title {
font

.card {
background: rgba(15, 15, 35, 0.8);
backdrop-filter: blur(20px);
border: 1px solid var(--glass-border-size: 20px;
font-weight: 700;
margin-bottom: 16px;
display: flex;
align-items: center;
gap: 10px;
color: var(--primary);
}

.stats-grid {
display: grid;
grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
gap:);
border-radius: 20px;
padding: 24px;
margin-bottom: 20px;
box-shadow: 0 8px 32px rgba(220 15px;
margin-bottom: 20px;
}

.stat-card {
background: rgba(15, 15, 35, 0.9);
border: , 38, 38, 0.15);
transition: all 0.3s ease;
position: relative;
overflow: hidden;
}

.card::before {
content: '';1px solid var(--glass-border);
border-radius: 16px;
padding: 20px;
text-align: center;
transition: all 0.3s ease;
position:
position: absolute;
top: 0;
left: 0;
right: 0;
height: 2px;
background: linear-gradient(90deg, var(--primary), var(--primary-light relative;
overflow: hidden;
}

.stat-card::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: ), var(--primary));
opacity: 0.7;
}

.card:hover {
transform: translateY(-4px);
box-shadow: 0 16px 48px rgba(220,0;
background: linear-gradient(135deg, rgba(220, 38, 38, 0.1), transparent);
opacity: 0;
transition: opacity 0. 38, 38, 0.25);
}

.card-title {
font-size: 20px;
font-weight: 700;
margin-bottom: 3s ease;
}

.stat-card:hover::before {
opacity: 1;
}

.stat-number {
font-size: 24px;
font-weight: 8016px;
display: flex;
align-items: center;
gap: 10px;
color: var(--primary);
}

.stats-grid {
display: grid;
grid-template0;
color: var(--primary);
margin-bottom: 8px;
}

.stat-label {
color: var(--text-light);
font-weight: 500;
font-size: 12px;
}

.btn {
padding: 12px 24px;
border: none;
border-radius: 12px;
font-weight: 600;
cursor-columns: repeat(auto-fit, minmax(150px, 1fr));
gap: 15px;
margin-bottom: 20px;
}

.stat-card {
: pointer;
display: inline-flex;
align-items: center;
gap: 8px;
transition: all 0.3s ease;
text-decoration: none;
font-size: background: rgba(15, 15, 35, 0.9);
border: 1px solid var(--glass-border);
border-radius: 16px;
padding: 214px;
position: relative;
overflow: hidden;
}

.btn:disabled {
opacity: 0.6;
cursor: not-allowed;
}

.btn::before {
content:0px;
text-align: center;
transition: all 0.3s ease;
position: relative;
overflow: hidden;
}

.stat-card::before {
content: '';
position: absolute;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: linear-gradient(135deg, rgba(220, 38, '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent 38, 0.1), transparent);
opacity: 0;
transition: opacity 0.3s ease;
}

.stat-card:hover::before {
opacity: 1;
}, rgba(255, 255, 255, 0.2), transparent);
transition: left 0.5s;
}

.btn:hover:not(:disabled)::before {
left: 100%;
}

.btn-primary {
background: linear-gradient(135deg, var(--primary), var(--primary-dark));
color: white;
}

.btn-primary:hover

.stat-number {
font-size: 24px;
font-weight: 800;
color: var(--primary);
margin-bottom: 8px;
}

.stat-:not(:disabled) {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
label {
color: var(--text-light);
font-weight: 500;
font-size: 12px;
}

.btn {
padding: 12px 24px;
border:}

.btn-success {
background: linear-gradient(135deg, var(--success), #047857);
color: white;
}

.btn-warning {
background: linear-gradient(13 none;
border-radius: 12px;
font-weight: 600;
cursor: pointer;
display: inline-flex;
align-items: center;
gap: 8px;
transition: all 0.3s ease;
text-decoration: none;
font-size: 14px;
position: relative;
overflow: hidden;
}

.btn:disabled {
opacity5deg, var(--warning), #b45309);
color: white;
}

.btn-secondary {
background: rgba(15, 15, 35, 0.8);
color: var(--text);
border: 1px solid var(--glass-border);
}

.btn-danger {
background: linear-gradient(135deg, var(--danger), #b91c1c: 0.6;
cursor: not-allowed;
}

.btn::before {
content: '';
position: absolute;
top: 0;
left: -100%;
width: 100%;
height: 100%;
background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent););
color: white;
}

.form-group {
margin-bottom: 20px;
}

.form-label {
display: block;
margin-bottom: 8px;
font-weight: 6
transition: left 0.5s;
}

.btn:hover:not(:disabled)::before {
left: 100%;
}

.btn-primary {
background: linear-gradient(135deg,00;
color: var(--text);
}

.form-input {
width: 100%;
padding: 12px 16px;
border: 2px solid var(--border var(--primary), var(--primary-dark));
color: white;
}

.btn-primary:hover:not(:disabled) {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(220, 38, 38, 0.4);
}

.btn-success {
background: linear-gradient(135deg, var(--success), #);
border-radius: 12px;
font-size: 16px;
transition: all 0.3s ease;
background: rgba(15, 15, 35, 0.8);
color: var(--text);
}

.form-input:focus {
outline: none;
border-color: var(--primary);
box-shadow: 0 0 0 047857);
color: white;
}

.btn-warning {
background: linear-gradient(135deg, var(--warning), #b45309);
color: white;
}

.btn-secondary {
background: rgba(15, 15, 35, 0.8);
color: var(--text);
border: 1px solid var(--glass-4px rgba(220, 38, 38, 0.1);
}

.task-grid {
display: grid;
gap: 15px;
}

.task-border);
}

.btn-danger {
background: linear-gradient(135deg, var(--danger), #b91c1c);
color: white;
}

.form-group {
margin-card {
background: rgba(15, 15, 35, 0.9);
border: 1px solid var(--glass-border);
border-radius: 16px;
paddingbottom: 20px;
}

.form-label {
display: block;
margin-bottom: 8px;
font-weight: 600;
color: var(--text);
}: 20px;
transition: all 0.3s ease;
position: relative;
overflow: hidden;
}

.task-card::before {
content: '';
position: absolute;
top

.form-input {
width: 100%;
padding: 12px 16px;
border: 2px solid var(--border);
border-radius: 12px;
: 0;
left: 0;
width: 4px;
height: 100%;
background: linear-gradient(180deg, var(--primary), var(--primary-light));
}

.taskfont-size: 16px;
transition: all 0.3s ease;
background: rgba(15, 15, 35, 0.8);
color: var(--text);-card:hover {
transform: translateX(5px);
box-shadow: 0 8px 25px rgba(220, 38, 38, 0.2);
}
}

.form-input:focus {
outline: none;
border-color: var(--primary);
box-shadow: 0 0 0 4px rgba(220, 38, 38, 0.1);
}

.task-grid {
display: grid;
gap: 15px;
}

.task-card {
background: rgba(15, 1

.task-header {
display: flex;
justify-content: space-between;
align-items: flex-start;
margin-bottom: 12px;
}

.task-title {
font-weight: 700;
color: var(--text);
margin-bottom: 8px;
}

.task-reward {
background: linear-gradient(135deg, var(--primary),5, 35, 0.9);
border: 1px solid var(--glass-border);
border-radius: 16px;
padding: 20px;
transition: all 0 var(--primary-light));
color: white;
padding: 6px 12px;
border-radius: 20px;
font-size: 12px;
font-weight: 700;.3s ease;
position: relative;
overflow: hidden;
}

.task-card::before {
content: '';
position: absolute;
top: 0;
left: 0;
width: 4px;
height: 100%;
background: linear-gradient(180deg, var(--primary), var(--primary-light));
}

.task-card:hover {
transform:
}

.task-description {
color: var(--text-light);
margin-bottom: 12px;
line-height: 1.5;
}

.task-actions {
display: translateX(5px);
box-shadow: 0 8px 25px rgba(220, 38, 38, 0.2);
}

.task-header {
display flex;
gap: 8px;
justify-content: flex-end;
}

.tabs {
display: flex;
background: rgba(15, 15, 35, 0.8);
border-radius: 12px;
padding: 4px;
margin-bottom: 20px;
border: 1px solid var(--glass-border);
}

.tab {
flex: 1: flex;
justify-content: space-between;
align-items: flex-start;
margin-bottom: 12px;
}

.task-title {
font-weight: 700;
color: var;
padding: 12px;
text-align: center;
border-radius: 8px;
cursor: pointer;
transition: all 0.3s ease;
font-weight: 600;
color(--text);
margin-bottom: 8px;
}

.task-reward {
background: linear-gradient(135deg, var(--primary), var(--primary-light));
color: white;
padding: 6px 12px;
border-radius: 20px;
font-size: 12px;
font-weight: 700;
}

.task-description {
color: var: var(--text-light);
}

.tab.active {
background: linear-gradient(135deg, var(--primary), var(--primary-dark));
color: white;
box-shadow: 0 4px (--text-light);
margin-bottom: 12px;
line-height: 1.5;
}

.task-actions {
display: flex;
gap: 8px;
justify-15px rgba(220, 38, 38, 0.3);
}

.tab-content {
display: none;
}

.tab-content.active {
display:content: flex-end;
}

.tabs {
display: flex;
background: rgba(15, 15, 35, 0.8);
border-radius: 12px;
padding: 4px;
margin-bottom: 20px;
border: 1px solid var(--glass-border);
}

.tab {
flex: 1;
padding: 12px;
text-align: center;
border-radius: 8px;
cursor: pointer;
transition: all 0.3s ease;
font-weight: 600;
color: var block;
}

.section {
display: none;
}

.section.active {
display: block;
}

.bottom-nav {
position: fixed;
bottom: 0;
left: 0;
right: 0;
background: rgba(15, 15, 35, 0.95);
backdrop-filter: blur(20px);
border-top: 1px solid var(--glass-border);
padding: 12px 0;
z-index: 1000;
}

.nav-container {
display: flex;
justify-content: space-around;
align-items(--text-light);
}

.tab.active {
background: linear-gradient(135deg, var(--primary), var(--primary-dark));
color: white;
box-shadow: 0 : center;
max-width: 500px;
margin: 0 auto;
}

.nav-item {
display: flex;
flex-direction: column;
align-items: center;
gap: 44px 15px rgba(220, 38, 38, 0.3);
}

.tab-content {
display: none;
}

.tab-content.active {
display: block;
}

.section {
display: none;
}

.section.active {
display: block;
}

.bottom-nav {
position: fixed;
bottom: 0;
left: px;
text-decoration: none;
color: var(--text-muted);
transition: all 0.3s ease;
padding: 8px 12px; /* Increased padding for larger size */
border-radius: 0;
right: 0;
background: rgba(15, 15, 35, 0.95);
backdrop-filter: blur(20px);
border-top: 1px solid var(--12px;
position: relative;
}

.nav-item.active,
.nav-item:hover {
color: var(--primary);
background: rgba(220, 38, 38, 0.1);
}

.nav-item span {
font-size: 12px;
font-weight: 600;
}

.spin-wheel {
width: 250pxglass-border);
padding: 12px 0;
z-index: 1000;
}

.nav-container {
display: flex;
justify-content: space-around;
align-items: center;
max-width: 500px;
margin: 0 auto;
}

.nav-item {
display: flex;
flex-direction: column;
align-items: center;
;
height: 250px;
border-radius: 50%;
border: 8px solid var(--primary);
margin: 20px auto;
position: relative;
background: conicgap: 4px;
text-decoration: none;
color: var(--text-muted);
transition: all 0.3s ease;
padding: 8px 12px; /* Increased padding for larger size */-gradient(
from 0deg,
var(--primary) 0deg 60deg,
var(--primary-light) 60deg 120deg,
var(--warning) 120deg 180
border-radius: 12px;
position: relative;
}

.nav-item.active,
.nav-item:hover {
color: var(--primary);
background: rgba(220, 38,deg,
var(--success) 180deg 240deg,
var(--primary-dark) 240deg 300deg,
var(--accent) 300deg 3 38, 0.1);
}

.nav-item span {
font-size: 12px;
font-weight: 600;
}

.spin-wheel {
width60deg
);
transition: transform 3s cubic-bezier(0.23, 1, 0.32, 1);
}

.spin-wheel::before {
content: '';
: 250px;
height: 250px;
border-radius: 50%;
border: 8px solid var(--primary);
margin: 20px auto;
position:position: absolute;
top: -15px;
left: 50%;
transform: translateX(-50%);
width: 0;
height: 0;
border-left: 15px solid transparent;
border-right: 15px solid transparent;
border-top: 30px solid var(--text);
z-index: 10;
}

.spin-center {
position relative;
background: conic-gradient(
from 0deg,
var(--primary) 0deg 60deg,
var(--primary-light) 60deg 120deg,
var(--warning) 12: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
width: 60px;
height: 60px;
background: var(--primary);
0deg 180deg,
var(--success) 180deg 240deg,
var(--primary-dark) 240deg 300deg,
var(--accent) border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-weight: 700;
z-index: 300deg 360deg
);
transition: transform 3s cubic-bezier(0.23, 1, 0.32, 1);
}

.spin-wheel::before {
content: '';
position: absolute;
top: -15px;
left: 50%;
transform: translateX(-50%);
width: 0;
height: 0;
border-5;
}

.modal {
display: none;
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
background: rgba(0, 0, 0, 0.8);
z-index: 2000;
backdrop-filter: blur(10px);
}

.modal-content {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: rgba(15, 15, 35, 0.95);
left: 15px solid transparent;
border-right: 15px solid transparent;
border-top: 30px solid var(--text);
z-index: 10;
}

.spin-center {
position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
width: 60px;
height: 60border: 1px solid var(--glass-border);
border-radius: 20px;
padding: 30px;
max-width: 400px;
width: 90%;px;
background: var(--primary);
border-radius: 50%;
display: flex;
align-items: center;
justify-content: center;
color: white;
font-weight: 700;

max-height: 80vh;
overflow-y: auto;
}

.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom:z-index: 5;
}

.modal {
display: none;
position: fixed;
top: 0;
left: 0;
right: 0;
bottom: 0;
 20px;
}

.modal-title {
font-size: 24px;
font-weight: 700;
color: var(--primary);
}

.close-btn {
backgroundbackground: rgba(0, 0, 0, 0.8);
z-index: 2000;
backdrop-filter: blur(10px);
}

.modal-content {
: none;
border: none;
font-size: 24px;
cursor: pointer;
color: var(--text-light);
}

.loading {
display: inline-block;
width:position: absolute;
top: 50%;
left: 50%;
transform: translate(-50%, -50%);
background: rgba(15, 15, 35, 0 20px;
height: 20px;
border: 3px solid rgba(255, 255, 255, .3);
border-radius: 50%;.95);
border: 1px solid var(--glass-border);
border-radius: 20px;
padding: 30px;
max-width: 400px;
width
border-top-color: #fff;
animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
to { transform: rotate(360deg); }
}

.: 90%;
max-height: 80vh;
overflow-y: auto;
}

.modal-header {
display: flex;
justify-content: space-between;
align-items: center;
margin-bottom: 20px;
}

.modal-title {
font-size: 24px;
font-weight: 700;
color: var(--primary);alert {
padding: 16px 20px;
border-radius: 12px;
margin-bottom: 20px;
border-left: 4px solid;
display: flex;
}

.close-btn {
background: none;
border: none;
font-size: 24px;
cursor: pointer;
color: var(--text-light);
}

.loading {
display: inline
align-items: center;
gap: 12px;
animation: slideIn 0.3s ease;
}

@keyframes slideIn {
from {
transform: translateX(-100%);
opacity: 0-block;
width: 20px;
height: 20px;
border: 3px solid rgba(255, 255, 255, .3);
border-;
}
to {
transform: translateX(0);
opacity: 1;
}
}

.alert-success {
background: rgba(5, 150, 105, 0.1);
radius: 50%;
border-top-color: #fff;
animation: spin 1s ease-in-out infinite;
}

@keyframes spin {
to { transform: rotate(360deg); }
}

.alert {
padding: 16px 20px;
border-radius: 12px;
margin-bottom: 20px;
border-left: 4px solidborder-left-color: var(--success);
color: var(--success);
}

.alert-danger {
background: rgba(220, 38, 38, 0.1);
;
display: flex;
align-items: center;
gap: 12px;
animation: slideIn 0.3s ease;
}

@keyframes slideIn {
from {
transform: translateX(-100border-left-color: var(--danger);
color: var(--danger);
}

.alert-warning {
background: rgba(217, 119, 6, 0.1);
%);
opacity: 0;
}
to {
transform: translateX(0);
opacity: 1;
}
}

.alert-success {
background: rgba(5, 150, 105,border-left-color: var(--warning);
color: var(--warning);
}

.progress-bar {
width: 100%;
height: 8px;
background: rgba(15, 15, 35, 0.8);
border-radius: 4px;
overflow: hidden;
margin: 10px 0;
}

.progress-fill {
height: 0.1);
border-left-color: var(--success);
color: var(--success);
}

.alert-danger {
background: rgba(220, 38, 38, 100%;
background: linear-gradient(90deg, var(--primary), var(--primary-light));
border-radius: 4px;
transition: width 0.3s ease;
} 0.1);
border-left-color: var(--danger);
color: var(--danger);
}

.alert-warning {
background: rgba(217, 119, 6,

.countdown {
font-size: 24px;
font-weight: 700;
color: var(--primary);
text-align: center;
margin: 20px 0;
}

 0.1);
border-left-color: var(--warning);
color: var(--warning);
}

.progress-bar {
width: 100%;
height: 8px;
background.refer-link {
background: rgba(15, 15, 35, 0.8);
border: 1px solid var(--glass-border);
border-radius: 12px;
padding: : rgba(15, 15, 35, 0.8);
border-radius: 4px;
overflow: hidden;
margin: 10px 0;
}

.progress12px;
color: var(--text);
font-family: monospace;
word-break: break-all;
margin: 10px 0;
}

.withdrawal-history {
max--fill {
height: 100%;
background: linear-gradient(90deg, var(--primary), var(--primary-light));
border-radius: 4px;
transition: width 0.height: 300px;
overflow-y: auto;
}

.history-item {
display: flex;
justify-content: space-between;
align-items: center;
padding: 3s ease;
}

.countdown {
font-size: 24px;
font-weight: 700;
color: var(--primary);
text-align: center;
margin: 20px12px;
border-bottom: 1px solid var(--border);
margin-bottom: 8px;
}

.history-status {
padding: 4px 8px;
border-radius 0;
}

.refer-link {
background: rgba(15, 15, 35, 0.8);
border: 1px solid var(--glass-border);
border-radius: 12px;
padding: 12px;
color: var(--text);
font-family: monospace;
word-break: break-all;
margin: 10px 0;
}

.withdrawal: 12px;
font-size: 12px;
font-weight: 600;
}

.status-pending {
background: rgba(217, 119, 6, 0-history {
max-height: 300px;
overflow-y: auto;
}

.history-item {
display: flex;
justify-content: space-between;
align-items:.2);
color: var(--warning);
}

.status-completed {
background: rgba(5, 150, 105, 0.2);
color: var(--success);
}

.status- center;
padding: 12px;
border-bottom: 1px solid var(--border);
margin-bottom: 8px;
}

.history-status {
padding: 4px 8rejected {
background: rgba(220, 38, 38, 0.2);
color: var(--danger);
}

.add-task-button {
margin-top: 1px;
border-radius: 12px;
font-size: 12px;
font-weight: 600;
}

.status-pending {
background: rgba(217, 119, 6, 0.2);
color: var(--warning);
}

.status-completed {
background: rgba(5, 150, 105, 0.2);
color: var(--success);5px;
text-align: center;
margin-bottom: 20px; /* Added margin for spacing */
}

.add-task-button .btn {
background: linear-gradient(135deg, var(--accent
}

.status-rejected {
background: rgba(220, 38, 38, 0.2);
color: var(--danger);
}

.add-task-button {
), var(--warning));
color: white;
}

.add-task-button .btn:hover {
transform: translateY(-2px);
box-shadow: 0 8px 25px rgba(245margin-top: 15px;
text-align: center;
margin-bottom: 20px; /* Added margin for spacing */
}

.add-task-button .btn {
background: linear-gradient(13, 158, 11, 0.4);
}

/* Modified for Add Task - Wallet Connect Button */
.add-task-wallet-section {
text-align: center;
margin-bottom: 25deg, var(--accent), var(--warning));
color: white;
}

.add-task-button .btn:hover {
transform: translateY(-2px);
box-shadow: 0 8px 250px;
padding: 15px;
background-color: rgba(15, 15, 35, 0.8);
border: 1px solid var(--glass-border);
border-px rgba(245, 158, 11, 0.4);
}

/* Modified for Add Task - Wallet Connect Button */
.add-task-wallet-section {
text-align: center;
radius: 16px;
display: flex;
flex-direction: column;
align-items: center;
gap: 10px;
}

#ton-connect-button-container {
/* This ismargin-bottom: 20px;
padding: 15px;
background-color: rgba(15, 15, 35, 0.8);
border: 1px solid var(--glass where TON Connect UI might render a default button if not overridden /
/ For this specific implementation, we'll manage buttons manually in profile section /
display: none; / Hide default TON Connect button container if not needed */
}

-border);
border-radius: 16px;
display: flex;
flex-direction: column;
align-items: center;
gap: 10px;
}

#ton-connect-button-.wallet-status-info {
margin-top: 15px;
padding: 10px;
border-radius: 8px;
text-align: center;
font-weight: 5container {
/* This is where TON Connect UI might render a default button if not overridden /
/ For this specific implementation, we'll manage buttons manually in profile section /
display: none; / Hide default TON Connect button container if00;
width: 100%; /* Occupy full width of its container */
}

.wallet-connected {
background: rgba(5, 150, 105, 0.1);
color: not needed */
}

.wallet-status-info {
margin-top: 15px;
padding: 10px;
border-radius: 8px;
text-align: center;
font- var(--success);
}

.wallet-disconnected {
background: rgba(220, 38, 38, 0.1);
color: var(--danger);
}

.profile-walletweight: 500;
width: 100%; /* Occupy full width of its container */
}

.wallet-connected {
background: rgba(5, 150, 105, 0-controls {
display: flex;
justify-content: center;
gap: 15px;
flex-wrap: wrap;
margin-top: 20px;
}

/* New section for Total Points to TON Conversion.1);
color: var(--success);
}

.wallet-disconnected {
background: rgba(220, 38, 38, 0.1);
color: var(--danger);
 in Profile */
.profile-ton-conversion {
margin-top: 20px;
padding: 15px;
background: rgba(15, 15, 35, 0.8);
border: 1px solid var(--glass-border);
border-radius: 16px;
text-align: center;
display: flex;
flex-direction: column;
align-items:}

.profile-wallet-controls {
display: flex;
justify-content: center;
gap: 15px;
flex-wrap: wrap;
margin-top: 20px;
}

/* New section for Total Points to TON Conversion in Profile */
.profile-ton-conversion {
margin-top: 20px;
padding: 15px;
background: rgba(15, 15, 35, 0.8);
border: 1px solid var(--glass-border);
border-radius: 16px;
text-align: center;
}

.profile-ton-conversion h3 {
 center;
gap: 10px;
}

.profile-ton-conversion h3 {
color: var(--primary);
margin-bottom: 15px;
}

.profile-ton-conversion p {
color: var(--text-light);
font-size: 14px;
line-height: 1.6;
}

.profile-ton-conversion .conversion-details {
display: flex;
flex-wrap: wrap;
justify-content: center;
gap: 10px;
margin-top: 10px;
}

.profile-ton-conversion .detail-item {
background: rgbacolor: var(--primary);
margin-bottom: 15px;
}

.profile-ton-conversion p {
color: var(--text-light);
font-size: 14px;
line-height: 1(31, 41, 55, 0.7); /* Darker background for detail items */
padding: 8px 12px;
border-radius: 8px;
font-size.6;
}

/* Withdrawal Modal adjustments */
.modal-content .form-group {
    margin-bottom: 15px; /* Slightly reduced margin for modal */
}

.modal-content .form-label {
    margin-bottom: 6px;
}

.modal-content .form-input {
    padding: 10px 14px;
}

.modal-content .btn {
    width: 13px;
border: 1px solid var(--border);
}

.profile-ton-conversion .detail-item strong {
color: var(--primary);
}

/* Minimalist Withdrawal Modal */
.withdrawal-modal-content {
    padding: 20px;
}

.withdrawal-modal-content .form-group {
    margin-bottom: 15px;
}

.withdrawal-modal-content: 100%; /* Full width button in modal */
    padding: 12px 20px;
}

.modal-content #withdrawAmount {
    background: rgba(10, 10, 2 .form-label {
    margin-bottom: 5px;
    font-size: 13px;
}

.withdrawal-modal-content .form-input {
    padding: 10px5, 0.9); /* Slightly darker input in modal */
    border-color: var(--border);
}

.modal-content #withdrawAmount:focus {
    border-color: var(--primary);
    box-shadow 12px;
    font-size: 14px;
}

.withdrawal-modal-content .btn {
    padding: 10px 20px;
    font-size: 13: 0 0 0 4px rgba(220, 38, 38, 0.1);
}


@media (max-width: 768px) {
.px;
}

@media (max-width: 768px) {
.container {
padding: 15px 10px 100px;
}

.header {
    container {
padding: 15px 10px 100px;
}

.header {
    flex-direction: column;
    gap: 15px;
    text-align: center;
}

.stats-grid {
    grid-template-columns: repeat(2, 1fr);
}

.modal-content {
    width: 95%;
    padding: 20px;
}

.flex-direction: column;
    gap: 15px;
    text-align: center;
}

.stats-grid {
    grid-template-columns: repeat(2, 1fr);
}

.modal-content {
    width: 95%;
    padding: 20px;
}

.spin-wheel {
    width: 200px;
    height: 200px;
spin-wheel {
    width: 200px;
    height: 200px;
}

.bottom-nav {
    padding: 10px 0;
}

.nav-item span {
}

.bottom-nav {
    padding: 10px 0;
}

.nav-item span {
    font-size: 10px;
}

.nav-item {
        font-size: 10px;
}

.nav-item {
    padding: 6px 8px;
}

.profile-wallet-controls {
    flex-direction: column;
    align-items:padding: 6px 8px;
}

.profile-wallet-controls {
    flex-direction: column;
    align-items: center;
}

.add-task-button {
    margin center;
}

.add-task-button {
    margin-bottom: 10px; /* Adjusted margin for mobile */
}

}

.pulse {
animation: pulse 2s infinite;
}

@keyframes pulse {
0% {
box-shadow: 0 0 0 0 rgba(220, 38, 38, 0.7);
}
70% {
box-shadow:-bottom: 10px; /* Adjusted margin for mobile */
}

.profile-ton-conversion {
    gap: 8px;
}

.profile-ton-conversion .conversion-details {
    gap 0 0 0 10px rgba(220, 38, 38, 0);
}
100% {
box-shadow: 0 0 0 0: 8px;
}

}

.pulse {
animation: pulse 2s infinite;
}

@keyframes pulse {
0% {
box-shadow: 0 0 0 0 rgba(220,  rgba(220, 38, 38, 0);
}
}

.glow {
box-shadow: 0 0 20px rgba(220, 38,38, 38, 0.7);
}
70% {
box-shadow: 0 0 0 10px rgba(220, 38, 38, 0); 38, 0.5);
}
</style>

</head>
<body>
    <div class="container">
        <div class="header">
            <div class="user-info">
                <
}
100% {
box-shadow: 0 0 0 0 rgba(220, 38, 38, 0);
}
}

.glow {
boximg src="https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&w=100-shadow: 0 0 20px rgba(220, 38, 38, 0.5);
}
</style>

</head>
<body>
    <div class="container">
        <&h=100&dpr=1" alt="User Avatar" class="user-avatar" id="userAvatar">
                <div class="user-details">
                    <h3 id="userName">Loadingdiv class="header">
            <div class="user-info">
                <img src="https://images.pexels.com/photos/220453/pexels-photo-220453...</h3>
                    <div class="user-balance">
                        <span class="material-icons">account_balance_wallet</span>
                        <span id="userBalance">0</span> Points
                    </div>
                </div>
            </div>
            <.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&dpr=1" alt="User Avatar" class="user-avatar" id="userAvatar">
                button class="theme-toggle" onclick="toggleTheme()">
                <span class="material-icons">dark_mode</span>
                Red Moon
            </button>
        </div>

    <div class="stats-grid"><div class="user-details">
                    <h3 id="userName">Loading...</h3>
                    <div class="user-balance">
                        <span class="material-icons">account_balance_wallet</span>
                        <span id="userBalance">0</span> Points
                    </div>
                </div>
            </div>
            <button class="theme-toggle" onclick="toggleTheme()">
                <span class="material-icons">dark_mode</span>
                Red Moon
            </button>
        </div>

    <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-number" id="totalEarned">0</div>
                <div class="stat-label">Total Earned</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="tasksCompleted">0</div>
                <div class="
            <div class="stat-card">
                <div class="stat-number" id="totalEarned">0</div>
                <div class="stat-label">Total Earned</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="tasksCompleted">0</div>
                <div class="stat-label">Tasks Done</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="referrals">0</div>
                <div class="stat-label">Referrals</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="spinsAvailable">0</div>
                <div class="stat-label">Spins Left</div>
            </div>
        </div>

        <!-- Home Section -->
        <div id="homestat-label">Tasks Done</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="referrals">0</div>
                <div class="stat-label">ReferSection" class="section active">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">home</span>
                    Welcome Back!
                </h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-primary" onclick="showSection('tasks')">
                        <span class="material-rals</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="spinsAvailable">0</div>
                <div class="stat-label">Spins Left</div>
icons">assignment</span>
                        Start Tasks
                    </button>
                    <button class="btn btn-warning" onclick="showSection('spin')">
                        <span class="material-icons">casino</span>
                        Spin Wheel            </div>
        </div>

        <!-- Home Section -->
        <div id="homeSection" class="section active">
            <div class="card">
                <h2 class="card-title">
                    <span
                    </button>
                    <button class="btn btn-success" onclick="dailyCheckin()">
                        <span class="material-icons">event_available</span>
                        Daily Check-in
                    </button>
 class="material-icons">home</span>
                    Welcome Back!
                </h2>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn btn-                </div>
            </div>

            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">redeem</span>
                    Lucky Code
                </h2>
                <divprimary" onclick="showSection('tasks')">
                        <span class="material-icons">assignment</span>
                        Start Tasks
                    </button>
                    <button class="btn btn-warning" onclick="showSection('spin class="form-group">
                    <input type="text" class="form-input" id="luckyCodeInput" placeholder="Enter lucky code">
                </div>
                <button class="btn btn-primary" onclick="')">
                        <span class="material-icons">casino</span>
                        Spin Wheel
                    </button>
                    <button class="btn btn-success" onclick="dailyCheckin()">
                        <span class="material-applyLuckyCode()">
                    <span class="material-icons">card_giftcard</span>
                    Apply Code
                </button>
            </div>

            <!-- Removed the "Connect Your Wallet" card from Home -->
            <!-- The TON Connect UI button will be managed by the JS in the profile section -->
            <div id="ton-connect-button-container">
                <!-- TON Connect UI might still use this for its internal logic if needed, but we're manually controllingicons">event_available</span>
                        Daily Check-in
                    </button>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">
                    <span class=" button display -->
            </div>
        </div>

        <!-- Tasks Section -->
        <div id="tasksSection" class="section">
            <div class="card">
                <h2 class="card-title">
material-icons">redeem</span>
                    Lucky Code
                </h2>
                <div class="form-group">
                    <input type="text" class="form-input" id="luckyCodeInput" placeholder="Enter lucky                    <span class="material-icons">assignment</span>
                    Tasks
                </h2>
                <!-- Add Task button moved to the top of the Task card -->
                <div class="add-task-button">
                    <button code">
                </div>
                <button class="btn btn-primary" onclick="applyLuckyCode()">
                    <span class="material-icons">card_giftcard</span>
                    Apply Code
                </button>
             class="btn btn-primary" onclick="showSection('addTask')">
                        <span class="material-icons">add</span>
                        Create New Task
                    </button>
                </div>
                <div class="tabs">
                    <div class</div>

            <!-- Removed the "Connect Your Wallet" card from Home -->
            <!-- The TON Connect UI button will be managed by the JS in the profile section -->
            <div id="ton-connect-button-container">
                <!-- TON Connect="tab active" onclick="showTaskTab(event, 'available')">Available</div>
                    <div class="tab" onclick="showTaskTab(event, 'completed')">Completed</div>
                </div>

                <div id UI might still use this for its internal logic if needed, but we're manually controlling button display -->
            </div>
        </div>

        <!-- Tasks Section -->
        <div id="tasksSection" class="section">
            ="availableTasks" class="tab-content active">
                    <div class="task-grid" id="availableTasksGrid">
                        <!-- Available tasks will be loaded here -->
                    </div>
                </div>

                <div id<div class="card">
                <h2 class="card-title">
                    <span class="material-icons">assignment</span>
                    Tasks
                </h2>
                <!-- Add Task button moved to the top of the Task="completedTasks" class="tab-content">
                    <div class="task-grid" id="completedTasksGrid">
                        <!-- Completed tasks will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Add card -->
                <div class="add-task-button">
                    <button class="btn btn-primary" onclick="showSection('addTask')">
                        <span class="material-icons">add</span>
                        Create New Task
                    </button>
                </div>
                <div class="tabs">
                    <div class="tab active" onclick="showTaskTab(event, 'available')">Available</div>
                    <div class="tab Task Section -->
        <div id="addTaskSection" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">add_task" onclick="showTaskTab(event, 'completed')">Completed</div>
                </div>

                <div id="availableTasks" class="tab-content active">
                    <div class="task-grid" id="availableTasks</span>
                    Create Task
                </h2>

                <!-- Wallet connect section specific to Add Task -->
                <div class="add-task-wallet-section">
                    <p style="color: var(--text-light);">Connect yourGrid">
                        <!-- Available tasks will be loaded here -->
                    </div>
                </div>

                <div id="completedTasks" class="tab-content">
                    <div class="task-grid" id="completedTasksGrid wallet to create and fund tasks.</p>
                    <!-- This area will be populated by updateWalletUI if no wallet is connected -->
                    <div id="connectWalletButtonAddTaskWrapper">
                        <!-- TON Connect UI or custom button will">
                        <!-- Completed tasks will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Add Task Section -->
        <div id="addTaskSection" class="section">
            <div class appear here -->
                    </div>
                </div>

                <form id="addTaskForm">
                    <div class="form-group">
                        <label class="form-label">Task Title</label>
                        <input type="card">
                <h2 class="card-title">
                    <span class="material-icons">add_task</span>
                    Create Task
                </h2>

                <!-- Wallet connect section specific to Add Task -->
                ="text" class="form-input" id="newTaskTitle" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Task Description</label>
                        <textarea<div class="add-task-wallet-section">
                    <p style="color: var(--text-light);">Connect your wallet to create and fund tasks.</p>
                    <!-- This area will be populated by updateWalletUI if no wallet is class="form-input" id="newTaskDescription" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Task URL</label>
                        <input type="url" class="form-input" id="newTaskUrl" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Impressions (10 connected -->
                    <div id="connectWalletButtonAddTaskWrapper">
                        <!-- TON Connect UI or custom button will appear here -->
                    </div>
                </div>

                <form id="addTaskForm">
                    <div class="0-5000)</label>
                        <input type="number" class="form-input" id="taskImpressions" min="100" max="5000" required>
                    </div>
form-group">
                        <label class="form-label">Task Title</label>
                        <input type="text" class="form-input" id="newTaskTitle" required>
                    </div>
                    <div class                    <div class="form-group">
                        <label class="form-label">Total Cost: <span id="totalCost">0</span> TON</label>
                        <div class="form-label" style="font="form-group">
                        <label class="form-label">Task Description</label>
                        <textarea class="form-input" id="newTaskDescription" rows="3" required></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Task URL</label>
                        <input type="url" class="form-input" id="newTaskUrl" required>
                    </div>
-size: 12px; color: var(--text-light);">
                            Rate: 0.1 TON per 100 impressions
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" id                    <div class="form-group">
                        <label class="form-label">Impressions (100-5000)</label>
                        <input type="number" class="form-input" id="createTaskButton">
                        <span class="material-icons">payment</span>
                        Create & Pay
                    </button>
                </form>
            </div>

            <div class="card">
                <h2="taskImpressions" min="100" max="5000" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Total Cost: <span class="card-title">
                    <span class="material-icons">list</span>
                    My Created Tasks
                </h2>
                <div id="myTasksGrid" class="task-grid">
                    <!-- User's id="totalCost">0</span> TON</label>
                        <div class="form-label" style="font-size: 12px; color: var(--text-light);">
                            Rate: 0.1 created tasks will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Spin Section -->
        <div id="spinSection" class="section">
            <div class="card">
                <h2 class="card-title TON per 100 impressions
                        </div>
                    </div>
                    <button type="submit" class="btn btn-primary" id="createTaskButton">
                        <span class="material-icons">payment</span>
                        Create & Pay
                    ">
                    <span class="material-icons">casino</span>
                    Spin Wheel
                </h2>
                <div style="text-align: center;">
                    <div class="spin-wheel" id="spinWheel">
</button>
                </form>
            </div>

            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">list</span>
                    My Created Tasks
                        <div class="spin-center">SPIN</div>
                    </div>
                    <button class="btn btn-primary" id="spinButton" onclick="spinWheel()">
                        <span class="material-icons">casino</span>
                        Spin Now
                    </button>
                    <p style="margin-top: 15px; color: var(--text-light);">
                        Spins Available: <span id="spinsCount">0</span>
                    </p>                </h2>
                <div id="myTasksGrid" class="task-grid">
                    <!-- User's created tasks will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Spin Section -->
        <div id="spin
                </div>
            </div>
        </div>

        <!-- Ads Section -->
        <div id="adsSection" class="section">
            <div class="card">
                <h2 class="card-title">
Section" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">casino</span>
                    Spin Wheel
                </h2>
                <div                    <span class="material-icons">play_circle</span>
                    Watch Ads
                </h2>
                <div style="text-align: center;">
                    <p style="margin-bottom: 20px; color style="text-align: center;">
                    <div class="spin-wheel" id="spinWheel">
                        <div class="spin-center">SPIN</div>
                    </div>
                    <button class="btn btn-: var(--text-light);">
                        Daily Limit: <span id="adsWatched">0</span>/50
                    </p>
                    <button class="btn btn-primary" id="watchAdButton" onclick="primary" id="spinButton" onclick="spinWheel()">
                        <span class="material-icons">casino</span>
                        Spin Now
                    </button>
                    <p style="margin-top: 15px;watchAd()">
                        <span class="material-icons">play_arrow</span>
                        Watch Ad (+10 Points)
                    </button>
                    <div id="adCountdown" class="countdown" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Referral Section -->
        <div id="referralSection" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">people</span>
                    Referral System
                </h2>
                <div class="form-group">
                    <label class="form-label">Your Referral Link</label>
                     color: var(--text-light);">
                        Spins Available: <span id="spinsCount">0</span>
                    </p>
                </div>
            </div>
        </div>

        <!-- Ads Section -->
        <div id="adsSection" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">play_circle</span>
                    Watch Ads
                </h2>
                <div style="text-align: center;">
                    <p style="margin-bottom: 20px; color: var(--text-light);">
                        Daily Limit: <span id="adsWatched">0</span>/50
                    </p<div class="refer-link" id="referralLink">
                        https://t.me/adflareprobot/app?startapp=ref_<span id="userRefId">loading</span>
                    </div>
                    >
                    <button class="btn btn-primary" id="watchAdButton" onclick="watchAd()">
                        <span class="material-icons">play_arrow</span>
                        Watch Ad (+10 Points)
                    <button class="btn btn-secondary" onclick="copyReferralLink()">
                        <span class="material-icons">content_copy</span>
                        Copy Link
                    </button>
                </div>

                <div style="display: grid; grid</button>
                    <div id="adCountdown" class="countdown" style="display: none;"></div>
                </div>
            </div>
        </div>

        <!-- Referral Section -->
        <div id="referralSection" class="section">
-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0;">
                    <div class="stat-card">
                        <div class="stat-number" id="total            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">people</span>
                    Referral System
                </h2>
                <div class="form-group">Referrals">0</div>
                        <div class="stat-label">Total Referrals</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="referralEarnings">
                    <label class="form-label">Your Referral Link</label>
                    <div class="refer-link" id="referralLink">
                        https://t.me/adflareprobot/app?start0</div>
                        <div class="stat-label">Referral Earnings</div>
                    </div>
                </div>

                <button class="btn btn-success" onclick="claimReferralRewards()">
                    <span class="material-app=ref_<span id="userRefId">loading</span>
                    </div>
                    <button class="btn btn-secondary" onclick="copyReferralLink()">
                        <span class="material-icons">content_copy</span>icons">redeem</span>
                    Claim Rewards
                </button>

                <div style="margin-top: 20px;">
                    <h3 style="color: var(--primary); margin-bottom: 15px;">Referral
                        Copy Link
                    </button>
                </div>

                <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px; margin: 20px 0 List</h3>
                    <div id="referralList">
                        <!-- Referral list will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profileSection" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">person</span>
                    Profile
                </h2>
                <div style="text-align;">
                    <div class="stat-card">
                        <div class="stat-number" id="totalReferrals">0</div>
                        <div class="stat-label">Total Referrals</div>
                    </div>
                    : center; margin-bottom: 20px;">
                    <img src="https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&dpr=1" alt="Profile" class="user-avatar" style="width: 100px; height<div class="stat-card">
                        <div class="stat-number" id="referralEarnings">0</div>
                        <div class="stat-label">Referral Earnings</div>
                    </div>
                </div>

                <button class="btn btn-success" onclick="claimReferralRewards()">
                    <span class="material-icons">redeem</span>
                    Claim Rewards
                </button>

                <div style="margin-top: 20px;">
                    <h: 100px;" id="profileAvatar">
                    <h3 style="margin: 15px 0; color: var(--text);" id="profileName">Loading...</h3>
                </div>

                <!--3 style="color: var(--primary); margin-bottom: 15px;">Referral List</h3>
                    <div id="referralList">
                        <!-- Referral list will be loaded here -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile Section -->
        <div id="profileSection" class="section">
            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">person</span>
                    Profile
                </h2>
                <div style="text-align: center; margin-bottom: 20px;">
                    <img src="https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&dpr=1" alt="Profile Wallet Connection Section in Profile -->
                <div class="card-title">
                    <span class="material-icons">account_balance_wallet</span>
                    Wallet Connection
                </div>
                <div id="walletStatusWrapper">
                    <!-- Wallet connection status will be displayed here -->
                </div>
                <div class="profile-wallet-controls" id="profileWalletControls">
                    <!-- Connect/Disconnect buttons will appear here, managed by JS -->
                </div>

" class="user-avatar" style="width: 100px; height: 100px;" id="profileAvatar">
                    <h3 style="margin: 15px 0; color:                <!-- Mini and Cute Total Points to TON Conversion Section in Profile -->
                <div class="profile-ton-conversion">
                    <h3 class="card-title">
                        <span class="material-icons">currency_exchange</span>
                        TON Conversion
                    </h3>
                    <div class="ton-conversion-details">
                        <p>
                            <strong id="profileCurrentPoints">0</strong> Points ≈ <strong id="profileEstimatedTon var(--text);" id="profileName">Loading...</h3>
                </div>

                <!-- Wallet Connection Section in Profile -->
                <div class="card-title">
                    <span class="material-icons">account_balance_wallet</span>
                    Wallet Connection
                </div>
                <div id="walletStatusWrapper">
                    <!-- Wallet connection status will be displayed here -->
                </div>
                <div class="profile-wallet-controls" id="profileWalletControls">
">0.00000000</strong> TON
                        </p>
                        <p class="conversion-rate">
                            Rate: 100 Points = 0.000078 TON
                        </p>
                        <p class="min-withdrawal">
                            Min Withdrawal: <strong id="minWithdrawPointsProfile">0.1</strong> TON
                        </p>
                    </div>
                </div>

                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="showWithdrawModal()">
                                            <!-- Connect/Disconnect buttons will appear here, managed by JS -->
                </div>

                <!-- Minimalist Total Points to TON Conversion Section -->
                <div class="profile-ton-conversion">
                    <h3 class="card-title">
                        <span class="material-icons">currency_exchange</span>
                        Your Balance
                    </h3>
                    <div class="conversion-details">
                        <div class="detail-item">
                            Points: <strong id<span class="material-icons">account_balance</span>
                        Withdraw
                    </button>
                    <button class="btn btn-secondary" onclick="window.open('https://t.me/PixelfrogCommunity', '_blank')="profileCurrentPoints">0</strong>
                        </div>
                        <div class="detail-item">
                            Est. TON: <strong id="profileEstimatedTon">0.00000000</strong>
                        </div>">
                        <span class="material-icons">support</span>
                        Support
                    </button>
                    <button class="btn btn-secondary" onclick="window.open('https://t.me/Pixelfrogchat', '_blank')
                    </div>
                    <p style="font-size: 11px; margin-top: 10px; color: var(--text-muted);">
                        Rate: 100 Points ≈ 0.000">
                        <span class="material-icons">code</span>
                        Developer
                    </button>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">
                    <span class="078 TON
                    </p>
                </div>

                <div style="display: flex; gap: 10px; flex-wrap: wrap; justify-content: center; margin-top: 20px;">
                    <button class="btn btn-primary" onclick="showWithdrawModal()">
                        <span class="material-icons">account_balance</span>
                        Withdraw
                    </button>
                    <button class="btnmaterial-icons">history</span>
                    Withdrawal History
                </h2>
                <div class="withdrawal-history" id="withdrawalHistory">
                    <!-- Withdrawal history will be loaded here -->
                </div>
            </div>
        </div>
 btn-secondary" onclick="window.open('https://t.me/PixelfrogCommunity', '_blank')">
                        <span class="material-icons">support</span>
                        Support
                    </button>
                    <button class="btn btn-secondary" onclick="window.open('https://t.me/Pixelfrogchat', '_blank')">
                        <span class="material-icons">code</span>
                        Developer
                    </button>
                </div>
            </div>

            <div class="card">
                <h2 class="card-title">
                    <span class="material-icons">history</span>
                    Withdrawal History
                </h2>
                    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav">
        <div class="nav-container">
            <a href="#" class="nav-item active" onclick="showSection('home'); return false;">
                <span class="material-icons">home</span>
                <span>Home</span>
            </a>
            <a href="#" class="nav-item" onclick="showSection('ads'); return false;">
                <span class="material-icons">play_circle</span>
                <span>Ads</span>
            </a>
            <a href="#" class="nav-item" onclick="showSection('tasks'); return false;">
                <span class="material-icons">assignment<div class="withdrawal-history" id="withdrawalHistory">
                    <!-- Withdrawal history will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation -->
    <div class="bottom-nav"></span>
                <span>Tasks</span>
            </a>
            <a href="#" class="nav-item" onclick="showSection('referral'); return false;">
                <span class="material-icons">share</span>
                <span>Refer
        <div class="nav-container">
            <a href="#" class="nav-item active" onclick="showSection('home'); return false;">
                <span class="material-icons">home</span>
                <span>Home</span>
            </span>
            </a>
            <a href="#" class="nav-item" onclick="showSection('profile'); return false;">
                <span class="material-icons">account_balance_wallet</span>
                <span>Profile</span>
            </a>
        </div>
    </div>

    <!-- Task Verification Modal -->
    <div id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Task Verification</h3>
                <button class="close-btn" onclick="closeModal('taskModal')">&times;</button>
            </div>
            <div id="taskModal</a>
            <a href="#" class="nav-item" onclick="showSection('ads'); return false;">
                <span class="material-icons">play_circle</span>
                <span>Ads</span>
            </a>
            <a href="#" class="nav-item" onclick="showSection('tasks'); return false;">
                <span class="material-icons">assignment</span>
                <span>Tasks</span>
            </a>
            <a href="#" class="navContent">
                <div class="countdown" id="taskCountdown">5</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="taskProgress"></div>
                </div>
                -item" onclick="showSection('referral'); return false;">
                <span class="material-icons">share</span>
                <span>Refer</span>
            </a>
            <a href="#" class="nav-item" onclick="<p style="text-align: center; color: var(--text-light);">
                    Please wait while we verify your task completion...
                </p>
            </div>
        </div>
    </div>

    <!-- Withdraw Modal -->
    <divshowSection('profile'); return false;">
                <span class="material-icons">account_balance_wallet</span>
                <span>Profile</span>
            </a>
        </div>
    </div>

    <!-- Task Verification Modal -->
    < id="withdrawModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Withdraw TON</h3>
                <button classdiv id="taskModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Task Verification</h3>
                <button="close-btn" onclick="closeModal('withdrawModal')">&times;</button>
            </div>
            <div id="withdrawModalWalletInfo">
                <!-- Wallet connection status and buttons will be displayed here -->
            </div>
            <form class="close-btn" onclick="closeModal('taskModal')">&times;</button>
            </div>
            <div id="taskModalContent">
                <div class="countdown" id="taskCountdown">5</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="taskProgress"></div>
                </div>
                <p style="text-align: center; color: var(--text-light);">
                    Please wait while we verify your task completion...
                </p>
            </div>
        </div>
    </div>

    <!-- Minimalist Withdrawal Modal -->
    <div id="withdrawModal" class="modal">
        <div class="modal id="withdrawForm">
                <div class="form-group">
                    <label class="form-label">TON Address</label>
                    <input type="text" class="form-input" id="tonAddress" readonly placeholder="Connect wallet to populate">
                </div>
                <div class="form-group">
                    <label class="form-label">Amount to Withdraw (TON)</label>
                    <input type="number"-content withdrawal-modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Withdraw to TON</h3>
                <button class="close-btn" onclick="closeModal(' class="form-input" id="withdrawAmount" step="0.00000001" required placeholder="Enter TON amount">
                    <div style="font-size: 12px; color:withdrawModal')">&times;</button>
            </div>
            <div id="withdrawModalWalletInfo">
                <!-- Wallet connection status and buttons will be displayed here -->
            </div>
            <form id="withdrawForm">
 var(--text-light); margin-top: 5px;">
                        Minimum: <span id="minWithdrawTon">0.1</span> TON | You have: <span id="userTonBalance">0</span> TON
                    </div>
                                <div class="form-group">
                    <label class="form-label">Your TON Wallet Address</label>
                    <input type="text" class="form-input" id="tonAddress" readonly placeholder="Connect</div>
                <div class="form-group">
                    <label class="form-label">Equivalent Points: <span id="pointsEquivalent">0</span></label>
                </div>
                <button type="submit" class="btn btn-primary" id="requestWithdrawButton">
                    <span class="material-icons">send</span>
                    Request Withdrawal
                </button>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>

    <!-- Optional: For ad loading, ensure this is correctly implemented if needed -->
    <!-- <script src='//libtl.com/ wallet to populate">
                </div>
                <div class="form-group">
                    <label class="form-label">Amount to Withdraw (TON)</label>
                    <input type="number" class="form-input" id="withdrawAmount" min="0.1" step="0.01" required placeholder="Enter TON amount">
                    <div style="font-size: 11px; color: var(--text-muted); margin-top: 5px;">
                        Minimum: <span id="minWithdrawTon">0.1</span> TON | Convert points to TON above to withdraw.
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Points Required: <span id="pointsRequired">0</span></label>
                </div>
                <button type="submit" class="btn btn-primary" id="requestWithdrawButton">
                    <spansdk.js' data-zone='9809601' data-sdk='show_9809601'></script> -->

    <script>
        // Firebase configuration
        const firebaseConfig class="material-icons">send</span>
                    Request Withdrawal
                </button>
            </form>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/ = {
            apiKey: "AIzaSyA3SqCHzN3kLj7DC8Cyu9OzxPFtIlyyii4",
            authDomain: "maneybux-clone.firebasefirebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-app.com",
            projectId: "maneybux-clone",
            storageBucket: "maneybux-clone.firebasestorage.app",
            messagingSenderId: "15320compat.js"></script>

    <!-- Optional: For ad loading, ensure this is correctly implemented if needed -->
    <!-- <script src='//libtl.com/sdk.js' data-zone='98097109623",
            appId: "1:153207109623:web:4cd48633c49c2ba3c1a0f2"601' data-sdk='show_9809601'></script> -->

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyA3
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // TON Connect setup
        const tonConnectUI = new TON_CONNECT_UI.TonConnectSqCHzN3kLj7DC8Cyu9OzxPFtIlyyii4",
            authDomain: "maneybux-clone.firebaseapp.com",
            projectId: "maneybUI({
            manifestUrl: 'https://moneybuc-clone-clint-1.vercel.app/tonconnect-manifest.json', // Your manifest URL
            // buttonRootId: 'ton-connect-button-containerux-clone",
            storageBucket: "maneybux-clone.firebasestorage.app",
            messagingSenderId: "153207109623",
            appId', // We'll manage buttons manually, so this might not be strictly necessary for the default button anymore
            actionsConfiguration: {
                twaReturnUrl: 'https://t.me/EarnFluxBot' // Your bot's username
            }
        });

        // Global variables
        let currentUser = null;
        let userBalancePoints = 0; // Renamed to clarify it's points
        let userSpins = 0: "1:153207109623:web:4cd48633c49c2ba3c1a0f2"
        };

        // Initialize Firebase
        firebase.;
        let adsWatchedToday = 0;
        let lastAdTime = 0;
        let dailyCheckinDone = false;
        let lastAdCompletionTime = 0;
        const REFERRAL_initializeApp(firebaseConfig);
        const database = firebase.database();

        // TON Connect setup
        const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
            manifestUrl: 'https://moneybuc-clone-clint-1.vercel.app/tonconnect-manifest.json', // Your manifest URL
            // buttonRootId: 'ton-connect-button-container', // We'll manage buttons manually, so this might not be strictlyBONUS_POINTS = 500;
        const POINTS_TO_TON_RATE = 100 / 0.000078; // 100 points for 0.0000 necessary for the default button anymore
            actionsConfiguration: {
                twaReturnUrl: 'https://t.me/EarnFluxBot' // Your bot's username
            }
        });

        // Global variables
        let currentUser78 TON
        const IMPRESSIONS_TO_TON_RATE = 100 / 0.1; // 100 impressions for 0.1 TON
        const AD_REWARD_POINTS = = null;
        let userBalance = 0;
        let userSpins = 0;
        let adsWatchedToday = 0;
        let lastAdTime = 0;
        let dailyCheckin 10;
        const CHECKIN_REWARD_POINTS = 50;
        const TASK_SPIN_REWARD = 1;
        const MIN_WITHDRAW_TON = 0.1;Done = false;
        let lastAdCompletionTime = 0;
        const REFERRAL_BONUS_POINTS = 500;
        const MIN_TON_WITHDRAWAL = 0.1; // Minimum withdrawal // Minimum withdrawal in TON

        // Initialize Telegram Web App
        function initTelegramWebApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();

                const user = tg.initDataUnsafe?.user;
                if (user) {
                    currentUser = {
                        id: user.id,
                        username: user.username || 'User',
                        first in TON
        const POINTS_TO_TON_RATE = 100 / 0.000078; // 100 points for 0.000078 TON (approx. 1 TON_name: user.first_name || 'User',
                        photo_url: user.photo_url || 'https://images.pexels.com/photos/220453/pexels-photo-22 = 1,282,051 points)
        const IMPRESSIONS_TO_TON_RATE = 100 / 0.1; // 100 impressions for 0.1 TON
        const AD0453.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&dpr=1'
                    };

                    const startParam = tg.initDataUnsafe?.start_param;
                    if (startParam && startParam.startsWith('ref_')) {
                        const referrerId = startParam.replace('ref_', '');
                        handleReferral(referrerId);
                    }

                    initializeUser_REWARD_POINTS = 10;
        const CHECKIN_REWARD_POINTS = 50;
        const TASK_SPIN_REWARD = 1;


        // Initialize Telegram Web App
        function();
                } else {
                    // Fallback for testing or when not in Telegram Web App context
                    const randomId = Math.floor(Math.random() * 1000000000);
                    currentUser = initTelegramWebApp() {
            if (window.Telegram && window.Telegram.WebApp) {
                const tg = window.Telegram.WebApp;
                tg.ready();

                const user = tg.initDataUnsafe?.user;
 {
                        id: randomId,
                        username: `testuser_${randomId}`,
                        first_name: 'Test User',
                        photo_url: 'https://images.pexels.com/photos/22                if (user) {
                    currentUser = {
                        id: user.id,
                        username: user.username || 'User',
                        first_name: user.first_name || 'User',
                        photo0453/pexels-photo-220453.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&dpr=1'
                    };_url: user.photo_url || 'https://images.pexels.com/photos/220453/pexels-photo-220453.jpeg?auto=compress&cs=tinys
                    console.warn("Running without Telegram Web App user data. Using a random ID for testing:", currentUser.id);
                    initializeUser();
                }
            } else {
                console.error("Telegram Web App isrgb&w=100&h=100&dpr=1'
                    };

                    const startParam = tg.initDataUnsafe?.start_param;
                    if (startParam && startParam not available.");
                showAlert("Error: Telegram Web App not detected. Please open this in Telegram.", "danger");
            }
        }

        // Initialize user data from Firebase
        async function initializeUser() {
            if (!currentUser) return.startsWith('ref_')) {
                        const referrerId = startParam.replace('ref_', '');
                        handleReferral(referrerId);
                    }

                    initializeUser();
                } else {
                    // Fallback for testing or;

            const userRef = database.ref('users/' + currentUser.id);
            const snapshot = await userRef.once('value');

            // If user doesn't exist, create a new entry
            if (!snapshot.exists when not in Telegram Web App context
                    const randomId = Math.floor(Math.random() * 1000000000);
                    currentUser = {
                        id: randomId,
                        ()) {
                const userData = {
                    id: currentUser.id,
                    username: currentUser.username,
                    first_name: currentUser.first_name,
                    photo_url: currentUser.photo_url,username: `testuser_${randomId}`,
                        first_name: 'Test User',
                        photo_url: 'https://images.pexels.com/photos/220453/pexels-photo-2
                    balance: 0, // This will store points
                    spins: 0,
                    totalEarned: 0,
                    tasksCompleted: 0,
                    referrals: 0,
                    refer20453.jpeg?auto=compress&cs=tinysrgb&w=100&h=100&dpr=1'
                    };
                    console.warn("Running without Telegram WebralEarnings: 0,
                    adsWatched: 0,
                    lastAdReset: Date.now(),
                    lastCheckin: null,
                    createdAt: Date.now()
                };
                await userRef.set(userData App user data. Using a random ID for testing:", currentUser.id);
                    initializeUser();
                }
            } else {
                console.error("Telegram Web App is not available.");
                showAlert("Error: Telegram);
            }

            // Set up real-time listener for user data
            userRef.on('value', (snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                     Web App not detected. Please open this in Telegram.", "danger");
            }
        }

        // Initialize user data from Firebase
        async function initializeUser() {
            if (!currentUser) return;

            const useruserBalancePoints = userData.balance || 0; // Store points in points variable
                    userSpins = userData.spins || 0;
                    adsWatchedToday = userData.adsWatched || 0;
                    lastAdTime = userData.Ref = database.ref('users/' + currentUser.id);
            const snapshot = await userRef.once('value');

            // If user doesn't exist, create a new entry
            if (!snapshot.exists()) {
                const userDatalastAdReset || 0;
                    dailyCheckinDone = userData.lastCheckin === new Date().toDateString();

                    // Reset daily ad count if 24 hours have passed
                    if (Date.now() = {
                    id: currentUser.id,
                    username: currentUser.username,
                    first_name: currentUser.first_name,
                    photo_url: currentUser.photo_url,
                    balance: 0 - lastAdTime > 24 * 60 * 60 * 1000) {
                        adsWatchedToday = 0;
                        userRef.update({
                            adsWatched: 0,,
                    spins: 0,
                    totalEarned: 0,
                    tasksCompleted: 0,
                    referrals: 0,
                    referralEarnings: 0,
                    adsWatched: 0,

                            lastAdReset: Date.now()
                        });
                    }

                    updateUI(userData); // Update general UI elements
                    updateWalletUI(); // Update wallet connection status and buttons
                    updateProfileTonConversion();                    lastAdReset: Date.now(),
                    lastCheckin: null,
                    createdAt: Date.now()
                };
                await userRef.set(userData);
            }

            // Set up real-time listener for user data
            userRef.on('value', (snapshot) => {
                const userData = snapshot.val();
                if (userData) {
                    userBalance = userData.balance || 0;
                    user // Update TON conversion info in profile
                    updateWithdrawModalInfo(); // Update TON balance in withdraw modal
                }
            });

            loadTasks();
            loadUserTasks();
            loadReferrals();
            loadWithdrawSpins = userData.spins || 0;
                    adsWatchedToday = userData.adsWatched || 0;
                    lastAdTime = userData.lastAdReset || 0;
                    dailyCheckinDone = userData.lastCheckin === new Date().toDateString();

                    // Reset daily ad count if 24 hours have passed
                    if (Date.now() - lastAdTime > 24 * 60 * 60 * 1alHistory();
        }

        // Update general UI elements with user data
        function updateUI(userData) {
            document.getElementById('userName').textContent = userData.first_name || 'User';
            document.000) {
                        adsWatchedToday = 0;
                        userRef.update({
                            adsWatched: 0,
                            lastAdReset: Date.now()
                        });
                    }

                    updategetElementById('userBalance').textContent = formatNumber(userData.balance || 0); // Display points
            document.getElementById('totalEarned').textContent = formatNumber(userData.totalEarned || 0);
            document.getElementById('tasksCompleted').textContent = formatNumber(userData.tasksCompleted || 0);
            document.getElementById('referrals').textContent = formatNumber(userData.referrals || 0);
            document.getElementById('spinsAvailableUI(userData); // Update general UI elements
                    updateWalletUI(); // Update wallet connection status and buttons
                    updateProfileTonConversion(); // Update TON conversion info in profile
                }
            });

            loadTasks();
            load').textContent = userData.spins || 0;
            document.getElementById('spinsCount').textContent = userData.spins || 0;
            document.getElementById('adsWatched').textContent = adsWatchedToday;
            document.UserTasks();
            loadReferrals();
            loadWithdrawalHistory();
        }

        // Update general UI elements with user data
        function updateUI(userData) {
            document.getElementById('userName').textContent =getElementById('userRefId').textContent = userData.id;

            if (userData.photo_url) {
                document.getElementById('userAvatar').src = userData.photo_url;
                document.getElementById('profileAvatar userData.first_name || 'User';
            document.getElementById('userBalance').textContent = formatNumber(userData.balance || 0);
            document.getElementById('totalEarned').textContent = formatNumber(userData.total').src = userData.photo_url;
            }

            document.getElementById('profileName').textContent = userData.first_name || 'User';

            const watchAdButton = document.getElementById('watchAdButton');
Earned || 0);
            document.getElementById('tasksCompleted').textContent = formatNumber(userData.tasksCompleted || 0);
            document.getElementById('referrals').textContent = formatNumber(userData.referrals ||             if (adsWatchedToday >= 50) {
                watchAdButton.disabled = true;
                watchAdButton.innerHTML = '<span class="material-icons">block</span> Daily Limit Reached';
            }0);
            document.getElementById('spinsAvailable').textContent = userData.spins || 0;
            document.getElementById('spinsCount').textContent = userData.spins || 0;
            document.getElementById('adsWatched').textContent = adsWatchedToday;
            document.getElementById('userRefId').textContent = userData.id;

            if (userData.photo_url) {
                document.getElementById('userAvatar').src = userData else {
                watchAdButton.disabled = false;
                watchAdButton.innerHTML = '<span class="material-icons">play_arrow</span> Watch Ad (+10 Points)';
            }

            const dailyCheckinButton =.photo_url;
                document.getElementById('profileAvatar').src = userData.photo_url;
            }

            document.getElementById('profileName').textContent = userData.first_name || 'User';

            const watchAdButton = document.querySelector('.btn-success[onclick="dailyCheckin()"]');
            if (dailyCheckinButton) {
                if (dailyCheckinDone) {
                    dailyCheckinButton.textContent = 'Checked In document.getElementById('watchAdButton');
            if (adsWatchedToday >= 50) {
                watchAdButton.disabled = true;
                watchAdButton.innerHTML = '<span class="material-icons">block!';
                    dailyCheckinButton.disabled = true;
                    dailyCheckinButton.classList.remove('btn-success');
                    dailyCheckinButton.classList.add('btn-secondary');
                } else {
                    dailyCheckinButton.innerHTML = '<span class="material-icons">event_available</span> Daily Check-in';
                    dailyCheckinButton.disabled = false;
                    dailyCheckinButton.classList.remove('btn</span> Daily Limit Reached';
            } else {
                watchAdButton.disabled = false;
                watchAdButton.innerHTML = '<span class="material-icons">play_arrow</span> Watch Ad (+10 Points)';
            }-secondary');
                    dailyCheckinButton.classList.add('btn-success');
                }
            }
        }

        // Update wallet UI elements based on connection status
        function updateWalletUI() {
            

            const dailyCheckinButton = document.querySelector('.btn-success[onclick="dailyCheckin()"]');
            if (dailyCheckinButton) {
                if (dailyCheckinDone) {
                    dailyCheckconst connectedWallet = tonConnectUI.account;
            const walletStatusWrapper = document.getElementById('walletStatusWrapper');
            const profileWalletControls = document.getElementById('profileWalletControls');
            const withdrawModalWalletInfo =inButton.textContent = 'Checked In!';
                    dailyCheckinButton.disabled = true;
                    dailyCheckinButton.classList.remove('btn-success');
                    dailyCheckinButton.classList.add('btn- document.getElementById('withdrawModalWalletInfo');
            const requestWithdrawButton = document.getElementById('requestWithdrawButton');
            const withdrawAmountInput = document.getElementById('withdrawAmount');
            const tonAddressInput = document.getElementByIdsecondary');
                } else {
                    dailyCheckinButton.innerHTML = '<span class="material-icons">event_available</span> Daily Check-in';
                    dailyCheckinButton.disabled = false;
                    dailyCheck('tonAddress');
            const connectWalletAddTaskWrapper = document.getElementById('connectWalletButtonAddTaskWrapper');

            // --- Update Status Display ---
            let walletStatusHtml = '';
            if (connectedWallet) {
                walletStatusinButton.classList.remove('btn-secondary');
                    dailyCheckinButton.classList.add('btn-success');
                }
            }
        }

        // Update wallet UI elements based on connection status
        function updateWalletHtml = `
                    <div class="wallet-status-info wallet-connected">
                        <span class="material-icons">account_balance_wallet</span>
                        Connected: ${connectedWallet.address.slice(0,UI() {
            const connectedWallet = tonConnectUI.account;
            const walletStatusWrapper = document.getElementById('walletStatusWrapper');
            const profileWalletControls = document.getElementById('profileWalletControls');
            const 6)}...${connectedWallet.address.slice(-6)}
                    </div>
                `;
            } else {
                walletStatusHtml = `
                    <div class="wallet-status-info wallet-disconnected">
                        <span class="material-icons">account_balance_wallet</span>
                        Wallet not connected.
                    </div>
                `;
            }
            if (walletStatusWrapper) walletStatusWrapper.innerHTML = walletStatusHtml; withdrawModalWalletInfo = document.getElementById('withdrawModalWalletInfo');
            const requestWithdrawButton = document.getElementById('requestWithdrawButton');
            const withdrawAmountInput = document.getElementById('withdrawAmount');
            const tonAddress
            if (withdrawModalWalletInfo) withdrawModalWalletInfo.innerHTML = walletStatusHtml;

            // --- Handle Wallet Buttons in Profile Section ---
            profileWalletControls.innerHTML = ''; // Clear previous buttons
            if (connectedWallet) {
Input = document.getElementById('tonAddress');
            const connectWalletAddTaskWrapper = document.getElementById('connectWalletButtonAddTaskWrapper');

            // --- Update Status Display ---
            let walletStatusHtml = '';
            if (connectedWallet                const disconnectButton = document.createElement('button');
                disconnectButton.className = 'btn btn-danger';
                disconnectButton.innerHTML = '<span class="material-icons">power_settings_new</span> Disconnect Wallet) {
                walletStatusHtml = `
                    <div class="wallet-status-info wallet-connected">
                        <span class="material-icons">account_balance_wallet</span>
                        Connected: ${connectedWallet.';
                disconnectButton.onclick = async () => {
                    await tonConnectUI.disconnect();
                    showAlert('Wallet disconnected successfully!', 'success');
                };
                profileWalletControls.appendChild(disconnectButton);
            } else {
                address.slice(0, 6)}...${connectedWallet.address.slice(-6)}
                    </div>
                `;
            } else {
                walletStatusHtml = `
                    <div class="wallet-status-// If not connected, display a "Connect Wallet" button
                const connectButton = document.createElement('button');
                connectButton.className = 'btn btn-primary';
                connectButton.innerHTML = '<span class="info wallet-disconnected">
                        <span class="material-icons">account_balance_wallet</span>
                        Wallet not connected.
                    </div>
                `;
            }
            if (walletStatusWrapper) walletStatusWrapper.material-icons">account_balance_wallet</span> Connect Wallet';
                connectButton.onclick = async () => {
                    await tonConnectUI.openModal(); // Open the TON Connect UI modal
                };
                profileWalletinnerHTML = walletStatusHtml;
            if (withdrawModalWalletInfo) withdrawModalWalletInfo.innerHTML = walletStatusHtml;

            // --- Handle Wallet Buttons in Profile Section ---
            profileWalletControls.innerHTML = ''; // Clear previous buttons
            ifControls.appendChild(connectButton); // Add to profile controls
            }

            // --- Handle Wallet Button in Add Task Section ---
            if (connectWalletAddTaskWrapper) {
                connectWalletAddTaskWrapper.innerHTML = ''; // (connectedWallet) {
                const disconnectButton = document.createElement('button');
                disconnectButton.className = 'btn btn-danger';
                disconnectButton.innerHTML = '<span class="material-icons">power_settings Clear previous content
                if (!connectedWallet) { // Only show connect button if wallet is NOT connected
                    const connectButton = document.createElement('button');
                    connectButton.className = 'btn btn-primary';
                    _new</span> Disconnect Wallet';
                disconnectButton.onclick = async () => {
                    await tonConnectUI.disconnect();
                    showAlert('Wallet disconnected successfully!', 'success');
                };
                profileWalletControls.appendChildconnectButton.innerHTML = '<span class="material-icons">account_balance_wallet</span> Connect Wallet to Create Task';
                    connectButton.style.width = '100%'; // Make it full width within the section
(disconnectButton);
            } else {
                // If not connected, display a "Connect Wallet" button
                const connectButton = document.createElement('button');
                connectButton.className = 'btn btn-primary';
                connectButton.                    connectButton.onclick = async () => {
                        await tonConnectUI.openModal();
                    };
                    connectWalletAddTaskWrapper.appendChild(connectButton);
                }
            }


            // --- Withdrawal Modal SpecificinnerHTML = '<span class="material-icons">account_balance_wallet</span> Connect Wallet';
                connectButton.onclick = async () => {
                    await tonConnectUI.openModal(); // Open the TON Connect UI modal
 Logic ---
            if (connectedWallet) {
                tonAddressInput.value = connectedWallet.address;
                requestWithdrawButton.disabled = false;
                withdrawAmountInput.disabled = false;
            } else {                };
                profileWalletControls.appendChild(connectButton); // Add to profile controls
            }

            // --- Handle Wallet Button in Add Task Section ---
            if (connectWalletAddTaskWrapper) {
                connectWalletAddTask
                tonAddressInput.value = '';
                requestWithdrawButton.disabled = true;
                withdrawAmountInput.disabled = true;
                // Ensure the connect button is visible in the withdrawal modal if not connected
                if (!withdrawModalWrapper.innerHTML = ''; // Clear previous content
                if (!connectedWallet) { // Only show connect button if wallet is NOT connected
                    const connectButton = document.createElement('button');
                    connectButton.className = 'btnWalletInfo.querySelector('.btn-primary')) { // Check if connect button already exists
                    const connectButton = document.createElement('button');
                    connectButton.className = 'btn btn-primary';
                    connectButton.innerHTML btn-primary';
                    connectButton.innerHTML = '<span class="material-icons">account_balance_wallet</span> Connect Wallet to Create Task';
                    connectButton.style.width = '100%'; // Make it = '<span class="material-icons">account_balance_wallet</span> Connect Wallet to Withdraw';
                    connectButton.style.width = '100%';
                    connectButton.onclick = async () => {
                        await full width within the section
                    connectButton.onclick = async () => {
                        await tonConnectUI.openModal();
                    };
                    connectWalletAddTaskWrapper.appendChild(connectButton);
                }
            }


 tonConnectUI.openModal();
                    };
                    withdrawModalWalletInfo.appendChild(connectButton);
                }
            }
        }

        // Load available tasks from Firebase
        function loadTasks() {
            const availableTasksGrid =            // --- Withdrawal Modal Specific Logic ---
            if (connectedWallet) {
                tonAddressInput.value = connectedWallet.address;
                requestWithdrawButton.disabled = false;
                withdrawAmountInput.disabled = false document.getElementById('availableTasksGrid');
            const completedTasksGrid = document.getElementById('completedTasksGrid');

            database.ref('tasks').on('value', (snapshot) => {
                availableTasksGrid.innerHTML =;
            } else {
                tonAddressInput.value = '';
                requestWithdrawButton.disabled = true;
                withdrawAmountInput.disabled = true;
                // Ensure the connect button is visible in the withdrawal modal if not connected
                if (!withdrawModalWalletInfo.querySelector('.btn-primary')) { // Check if connect button already exists
                    const connectButton = document.createElement('button');
                    connectButton.className = 'btn btn '';
                completedTasksGrid.innerHTML = '';

                const tasks = snapshot.val();
                if (!tasks) {
                    availableTasksGrid.innerHTML = '<p style="text-align: center; color: var(--text-light);">No tasks available</p>';
                    return;
                }

                // Check which tasks the current user has completed
                database.ref('userTasks/' + currentUser.id).once('value', (userTasksSnapshot) => {-primary';
                    connectButton.innerHTML = '<span class="material-icons">account_balance_wallet</span> Connect Wallet to Withdraw';
                    connectButton.style.width = '100%';
                    connectButton.
                    const userTasksData = userTasksSnapshot.val() || {};

                    Object.keys(tasks).forEach(taskId => {
                        const task = tasks[taskId];
                        // Ensure task has necessary properties before processing
onclick = async () => {
                        await tonConnectUI.openModal();
                    };
                    withdrawModalWalletInfo.appendChild(connectButton);
                }
            }
        }

        // Load available tasks from Firebase
                                if (!task || !task.title || !task.description || !task.url || task.status !== 'active') {
                            console.warn("Skipping malformed task:", taskId, task);
                            return;function loadTasks() {
            const availableTasksGrid = document.getElementById('availableTasksGrid');
            const completedTasksGrid = document.getElementById('completedTasksGrid');

            database.ref('tasks').on('value', (snapshot) => {

                        }

                        const isCompleted = userTasksData[taskId] && userTasksData[taskId].completed === true;
                        const taskCard = createTaskCard(taskId, task, isCompleted);

                        if (isCompleted                availableTasksGrid.innerHTML = '';
                completedTasksGrid.innerHTML = '';

                const tasks = snapshot.val();
                if (!tasks) {
                    availableTasksGrid.innerHTML = '<p style="text-align) {
                            completedTasksGrid.appendChild(taskCard);
                        } else {
                            availableTasksGrid.appendChild(taskCard);
                        }
                    });

                    // Display messages if no tasks are available in a tab: center; color: var(--text-light);">No tasks available</p>';
                    return;
                }

                // Check which tasks the current user has completed
                database.ref('userTasks/' + currentUser.id).once('value', (userTasksSnapshot) => {
                    const userTasksData = userTasksSnapshot.val() || {};

                    Object.keys(tasks).forEach(taskId => {
                        const task = tasks[taskId
                    if (availableTasksGrid.children.length === 0) {
                        availableTasksGrid.innerHTML = '<p style="text-align: center; color: var(--text-light);">No available tasks</p>';
                    }
                    if (completedTasksGrid.children.length === 0) {
                        completedTasksGrid.innerHTML = '<p style="text-align: center; color: var(--text-light);">No completed tasks</p];
                        // Ensure task has necessary properties before processing
                        if (!task || !task.title || !task.description || !task.url || task.status !== 'active') {
                            console.warn("Skipping malformed task:", taskId, task);
                            return;
                        }

                        const isCompleted = userTasksData[taskId] && userTasksData[taskId].completed === true;
                        const taskCard = createTaskCard(taskId>';
                    }
                });
            });
        }

        // Create a task card HTML element
        function createTaskCard(taskId, task, isCompleted) {
            const card = document.createElement('div');
            card., task, isCompleted);

                        if (isCompleted) {
                            completedTasksGrid.appendChild(taskCard);
                        } else {
                            availableTasksGrid.appendChild(taskCard);
                        }
                    });

className = 'task-card';

            const statusClass = isCompleted ? 'btn-success' : 'btn-primary';
            const statusText = isCompleted ? 'Completed' : 'Start Task';
            const status                    // Display messages if no tasks are available in a tab
                    if (availableTasksGrid.children.length === 0) {
                        availableTasksGrid.innerHTML = '<p style="text-align: center; color:Icon = isCompleted ? 'check_circle' : 'play_arrow';

            card.innerHTML = `
                <div class="task-header">
                    <div class="task-title">${task.title}</div>
                    <div class="task-reward">${task.reward || 100} points</div>
                </div>
                <div class="task-description">${task.description}</div>
                <div class="task-actions">
                    <button var(--text-light);">No available tasks</p>';
                    }
                    if (completedTasksGrid.children.length === 0) {
                        completedTasksGrid.innerHTML = '<p style="text-align: center; color: var(--text-light);">No completed tasks</p>';
                    }
                });
            });
        }

        // Create a task card HTML element
        function createTaskCard(taskId, task, isCompleted) {
             class="btn ${statusClass}" ${isCompleted ? 'disabled' : `onclick="startTask('${taskId}', '${task.url}', ${task.reward || 100})"`}>
                        <span class="material-icons">${const card = document.createElement('div');
            card.className = 'task-card';

            const statusClass = isCompleted ? 'btn-success' : 'btn-primary';
            const statusText = isCompletedstatusIcon}</span>
                        ${statusText}
                    </button>
                </div>
            `;

            return card;
        }

        // Start task: Opens URL and starts verification timer
        function startTask(taskId, url, reward) ? 'Completed' : 'Start Task';
            const statusIcon = isCompleted ? 'check_circle' : 'play_arrow';

            card.innerHTML = `
                <div class="task-header">
                     {
            window.open(url, '_blank'); // Open the task URL in a new tab
            document.getElementById('taskModal').style.display = 'block'; // Show the verification modal

            let countdown = 5<div class="task-title">${task.title}</div>
                    <div class="task-reward">${task.reward || 100} points</div>
                </div>
                <div class="task-description">${task; // Verification countdown
            const countdownElement = document.getElementById('taskCountdown');
            const progressElement = document.getElementById('taskProgress');

            progressElement.style.width = '0%'; // Reset progress bar

            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                progressElement.style.width = ((5 - countdown) / 5) * 100 + '%'; // Update.description}</div>
                <div class="task-actions">
                    <button class="btn ${statusClass}" ${isCompleted ? 'disabled' : `onclick="startTask('${taskId}', '${task.url}', ${task.reward progress bar

                if (countdown <= 0) {
                    clearInterval(timer);
                    completeTask(taskId, reward); // Call function to complete task
                }
            }, 1000);
        }

        // Complete || 100})"`}>
                        <span class="material-icons">${statusIcon}</span>
                        ${statusText}
                    </button>
                </div>
            `;

            return card;
        }

        // Start task: task: Updates user balance and marks task as done in Firebase
        async function completeTask(taskId, reward) {
            try {
                const userRef = database.ref('users/' + currentUser.id);
                const Opens URL and starts verification timer
        function startTask(taskId, url, reward) {
            window.open(url, '_blank'); // Open the task URL in a new tab
            document.getElementById('taskModal').style userTaskRef = database.ref('userTasks/' + currentUser.id + '/' + taskId);

                // Check if task was already completed by this user
                const existingUserTaskSnapshot = await userTaskRef.once('value');
                if (.display = 'block'; // Show the verification modal

            let countdown = 5; // Verification countdown
            const countdownElement = document.getElementById('taskCountdown');
            const progressElement = document.getElementById('taskProgress');existingUserTaskSnapshot.exists() && existingUserTaskSnapshot.val().completed === true) {
                    closeModal('taskModal');
                    showAlert('This task has already been completed.', 'warning');
                    return;
                

            progressElement.style.width = '0%'; // Reset progress bar

            const timer = setInterval(() => {
                countdown--;
                countdownElement.textContent = countdown;
                progressElement.style.width = ((5 - countdown) / 5) * 100 + '%'; // Update progress bar

                if (countdown <= 0) {
                    clearInterval(timer);
                    completeTask(taskId, reward); // Call function}

                // Atomically update user data: add points, increment task count, grant a spin
                await userRef.transaction((userData) => {
                    if (userData) {
                        userData.balance = (userData. to complete task
                }
            }, 1000);
        }

        // Complete task: Updates user balance and marks task as done in Firebase
        async function completeTask(taskId, reward) {
            try {
                balance || 0) + reward;
                        userData.totalEarned = (userData.totalEarned || 0) + reward;
                        userData.tasksCompleted = (userData.tasksCompleted || 0) + 1const userRef = database.ref('users/' + currentUser.id);
                const userTaskRef = database.ref('userTasks/' + currentUser.id + '/' + taskId);

                // Check if task was already completed by;
                        userData.spins = (userData.spins || 0) + TASK_SPIN_REWARD; // Grant a spin for completing a task
                    }
                    return userData;
                });

                // Mark task as completed for this user
                await userTaskRef.set({
                    completedAt: Date.now(),
                    reward: reward,
                    completed: true
                });

                closeModal('taskModal');
 this user
                const existingUserTaskSnapshot = await userTaskRef.once('value');
                if (existingUserTaskSnapshot.exists() && existingUserTaskSnapshot.val().completed === true) {
                    closeModal('                showAlert(`Task completed! You earned ${reward} points and ${TASK_SPIN_REWARD} spin!`, 'success');

            } catch (error) {
                console.error('Error completing task:', error);taskModal');
                    showAlert('This task has already been completed.', 'warning');
                    return;
                }

                // Atomically update user data: add points, increment task count, grant a spin
                await userRef
                showAlert('Error completing task. Please try again.', 'danger');
                closeModal('taskModal');
            }
        }

        // Apply a lucky code
        async function applyLuckyCode() {
            const.transaction((userData) => {
                    if (userData) {
                        userData.balance = (userData.balance || 0) + reward;
                        userData.totalEarned = (userData.totalEarned || 0 code = document.getElementById('luckyCodeInput').value.trim().toUpperCase();
            if (!code) {
                showAlert('Please enter a lucky code', 'danger');
                return;
            }

            try {
                const codesRef) + reward;
                        userData.tasksCompleted = (userData.tasksCompleted || 0) + 1;
                        userData.spins = (userData.spins || 0) + TASK_SPIN_REWARD = database.ref('luckyCodes');
                const snapshot = await codesRef.once('value');
                const codes = snapshot.val();

                if (!codes) {
                    showAlert('No lucky codes available.', 'danger; // Grant a spin for completing a task
                    }
                    return userData;
                });

                // Mark task as completed for this user
                await userTaskRef.set({
                    completedAt: Date.now(),
                    reward: reward');
                    return;
                }

                let foundCode = null;
                let codeKey = null;

                // Find the code if it exists, is not used, and has not expired
                Object.keys(codes).forEach(key => {
                    if (codes[key].code === code && !codes[key].used && codes[key].expiresAt > Date.now()) {
                        foundCode = codes[key];
,
                    completed: true
                });

                closeModal('taskModal');
                showAlert(`Task completed! You earned ${reward} points and ${TASK_SPIN_REWARD} spin!`, 'success');

                                    codeKey = key;
                    }
                });

                if (!foundCode) {
                    showAlert('Invalid, expired, or already used lucky code', 'danger');
                    return;
                }

                // Update} catch (error) {
                console.error('Error completing task:', error);
                showAlert('Error completing task. Please try again.', 'danger');
                closeModal('taskModal');
            }
        }

 user balance and mark the code as used
                const userRef = database.ref('users/' + currentUser.id);
                await userRef.transaction((userData) => {
                    if (userData) {
                        userData.balance = (userData        // Apply a lucky code
        async function applyLuckyCode() {
            const code = document.getElementById('luckyCodeInput').value.trim().toUpperCase();
            if (!code) {
                showAlert('Please enter a.balance || 0) + foundCode.reward;
                        userData.totalEarned = (userData.totalEarned || 0) + foundCode.reward;
                    }
                    return userData;
                });

 lucky code', 'danger');
                return;
            }

            try {
                const codesRef = database.ref('luckyCodes');
                const snapshot = await codesRef.once('value');
                const codes = snapshot.val();                await database.ref('luckyCodes/' + codeKey).update({ used: true });

                document.getElementById('luckyCodeInput').value = ''; // Clear input
                showAlert(`Lucky code applied! You earned ${foundCode.reward}

                if (!codes) {
                    showAlert('No lucky codes available.', 'danger');
                    return;
                }

                let foundCode = null;
                let codeKey = null;

                // Find the code points!`, 'success');

            } catch (error) {
                console.error('Error applying lucky code:', error);
                showAlert('Error applying lucky code. Please try again.', 'danger');
            }
         if it exists, is not used, and has not expired
                Object.keys(codes).forEach(key => {
                    if (codes[key].code === code && !codes[key].used && codes[key].}

        // Spin the wheel to win rewards
        function spinWheel() {
            if (userSpins <= 0) {
                showAlert('No spins available! Complete tasks to earn spins.', 'danger');
                expiresAt > Date.now()) {
                        foundCode = codes[key];
                        codeKey = key;
                    }
                });

                if (!foundCode) {
                    showAlert('Invalid, expired, or alreadyreturn;
            }

            const spinButton = document.getElementById('spinButton');
            const wheel = document.getElementById('spinWheel');

            spinButton.disabled = true; // Disable button during spin
            wheel. used lucky code', 'danger');
                    return;
                }

                // Update user balance and mark the code as used
                const userRef = database.ref('users/' + currentUser.id);
                await userRef.transaction((userDatastyle.transform = ''; // Reset previous transform for smooth animation
            wheel.style.transition = 'transform 3s cubic-bezier(0.23, 1, 0.32, 1)'; // Apply transition

            // Calculate a random rotation that ensures it lands on a segment
            const randomRotation = Math.floor(Math.random() * 360) + 1800; // At least 5 full rotations for visual effect) => {
                    if (userData) {
                        userData.balance = (userData.balance || 0) + foundCode.reward;
                        userData.totalEarned = (userData.totalEarned || 0)
            wheel.style.transform = `rotate(${randomRotation}deg)`;

            // After the animation, determine the reward
            setTimeout(async () => {
                const normalizedRotation = randomRotation % 360; + foundCode.reward;
                    }
                    return userData;
                });

                await database.ref('luckyCodes/' + codeKey).update({ used: true });

                document.getElementById('luckyCodeInput').value
                let reward;

                // Determine reward based on the landing segment (matching conic-gradient colors)
                if (normalizedRotation < 60) reward = 100;       // --primary
                else if = ''; // Clear input
                showAlert(`Lucky code applied! You earned ${foundCode.reward} points!`, 'success');

            } catch (error) {
                console.error('Error applying lucky code:', error); (normalizedRotation < 120) reward = 150; // --primary-light
                else if (normalizedRotation < 180) reward = 200; // --warning
                else if
                showAlert('Error applying lucky code. Please try again.', 'danger');
            }
        }

        // Spin the wheel to win rewards
        function spinWheel() {
            if (userSpins <= 0 (normalizedRotation < 240) reward = 300; // --success
                else if (normalizedRotation < 300) reward = 400; // --primary-dark
                else reward) {
                showAlert('No spins available! Complete tasks to earn spins.', 'danger');
                return;
            }

            const spinButton = document.getElementById('spinButton');
            const wheel = document.getElementById('spinWheel');

             = 500;                             // --accent

                // Update user balance and decrement spins
                const userRef = database.ref('users/' + currentUser.id);
                await userRef.transaction((userData) => {spinButton.disabled = true; // Disable button during spin
            wheel.style.transform = ''; // Reset previous transform for smooth animation
            wheel.style.transition = 'transform 3s cubic-bezier(0.2
                    if (userData) {
                        userData.balance = (userData.balance || 0) + reward;
                        userData.totalEarned = (userData.totalEarned || 0) + reward;
                        userData3, 1, 0.32, 1)'; // Apply transition

            // Calculate a random rotation that ensures it lands on a segment
            const randomRotation = Math.floor(Math.random() * 3.spins = Math.max(0, (userData.spins || 0) - 1);
                    }
                    return userData;
                });

                spinButton.disabled = false; // Re-enable button
                60) + 1800; // At least 5 full rotations for visual effect
            wheel.style.transform = `rotate(${randomRotation}deg)`;

            // After the animation, determine the reward
            setTimeout(async ()wheel.style.transition = ''; // Remove transition after spin to prevent animation on next click
                showAlert(`Congratulations! You won ${reward} points!`, 'success');

            }, 3000); // Match this duration with the CSS transition duration => {
                const normalizedRotation = randomRotation % 360;
                let reward;

                // Determine reward based on the landing segment (matching conic-gradient colors)
                if (normalizedRotation < 60
        }

        // Watch an advertisement to earn points
        async function watchAd() {
            if (adsWatchedToday >= 50) {
                showAlert('Daily ad limit reached. Come back tomorrow!', 'danger) reward = 100;       // --primary
                else if (normalizedRotation < 120) reward = 150; // --primary-light
                else if (normalizedRotation < 18');
                return;
            }

            // Cooldown to prevent rapid clicking
            if (Date.now() - lastAdCompletionTime < 30000) { // 30-second cooldown
                0) reward = 200; // --warning
                else if (normalizedRotation < 240) reward = 300; // --success
                else if (normalizedRotation < 300)showAlert('Please wait a moment before watching another ad.', 'warning');
                return;
            }

            // This part depends on your ad provider. 'show_9809601()' is a placeholder.
 reward = 400; // --primary-dark
                else reward = 500;                             // --accent

                // Update user balance and decrement spins
                const userRef = database.ref('users/' + currentUser.id);            // If you have a real ad SDK, integrate its call here.
            try {
                if (typeof show_9809601 === 'function') {
                    await show_98096
                await userRef.transaction((userData) => {
                    if (userData) {
                        userData.balance = (userData.balance || 0) + reward;
                        userData.totalEarned = (userData.total01(); // Call your ad SDK to show an ad
                } else {
                    // Simulate ad watching for testing purposes
                    console.log("Simulating ad watch...");
                    await new Promise(resolve => setTimeout(resolveEarned || 0) + reward;
                        userData.spins = Math.max(0, (userData.spins || 0) - 1);
                    }
                    return userData;
                });

                , 5000)); // Simulate a 5-second ad
                    console.log("Simulated ad finished.");
                }

                // If ad was successfully watched, update user balance and ad count
                const userRef = database.ref('users/' + currentUser.id);
                await userRef.transaction((userData) => {
                    if (userData) {
                        userData.balance = (userData.balance || 0) + ADspinButton.disabled = false; // Re-enable button
                wheel.style.transition = ''; // Remove transition after spin to prevent animation on next click
                showAlert(`Congratulations! You won ${reward} points!`, 'success_REWARD_POINTS;
                        userData.totalEarned = (userData.totalEarned || 0) + AD_REWARD_POINTS;
                        userData.adsWatched = (userData.adsWatched || 0)');

            }, 3000); // Match this duration with the CSS transition duration
        }

        // Watch an advertisement to earn points
        async function watchAd() {
            if (adsWatchedToday >= 50) { + 1;
                    }
                    return userData;
                });

                adsWatchedToday++;
                lastAdCompletionTime = Date.now();
                showAlert(`Ad watched! You earned ${AD_REWARD_POINTS
                showAlert('Daily ad limit reached. Come back tomorrow!', 'danger');
                return;
            }

            // Cooldown to prevent rapid clicking
            if (Date.now() - lastAdCompletionTime < 3} points!`, 'success');

            } catch (error) {
                console.error('Error watching ad:', error);
                showAlert('Error loading ad. Please try again.', 'danger');
            }
        }

        // Daily check-in feature
        async function dailyCheckin() {
            const today = new Date().toDateString();
            const userRef = database.ref('users/' + currentUser.id);
            const0000) { // 30-second cooldown
                showAlert('Please wait a moment before watching another ad.', 'warning');
                return;
            }

            // This part depends on your ad provider. ' snapshot = await userRef.once('value');
            const userData = snapshot.val();

            if (userData.lastCheckin === today) {
                showAlert('You have already checked in today!', 'danger');
                show_9809601()' is a placeholder.
            // If you have a real ad SDK, integrate its call here.
            try {
                if (typeof show_9809601return;
            }

            // You might want to open a link or perform some action here.
            // For now, we'll simulate a short delay before crediting points.
            await new Promise(resolve => setTimeout === 'function') {
                    await show_9809601(); // Call your ad SDK to show an ad
                } else {
                    // Simulate ad watching for testing purposes
                    console.log("Simulating ad watch...");
                    await new Promise(resolve => setTimeout(resolve, 5000)); // Simulate a 5-second ad
                    console.log("Simulated ad finished.");
                }

                // If(resolve, 1000));

            // Update user balance and record check-in date
            await userRef.update({
                balance: (userData.balance || 0) + CHECKIN_REWARD_POINTS,
                totalEarned: (userData.totalEarned || 0) + CHECKIN_REWARD_POINTS,
                lastCheckin: today
            });

            showAlert(`Daily check-in completed! You earned ${CHECKIN_ ad was successfully watched, update user balance and ad count
                const userRef = database.ref('users/' + currentUser.id);
                await userRef.transaction((userData) => {
                    if (userData) {
REWARD_POINTS} points!`, 'success');

            // Update the button state
            const dailyCheckinButton = document.querySelector('.btn-success[onclick="dailyCheckin()"]');
            if (dailyCheck                        userData.balance = (userData.balance || 0) + AD_REWARD_POINTS;
                        userData.totalEarned = (userData.totalEarned || 0) + AD_REWARD_POINTS;
inButton) {
                dailyCheckinButton.textContent = 'Checked In!';
                dailyCheckinButton.disabled = true;
                dailyCheckinButton.classList.remove('btn-success');
                dailyCheckin                        userData.adsWatched = (userData.adsWatched || 0) + 1;
                    }
                    return userData;
                });

                adsWatchedToday++;
                lastAdCompletionTime = Date.now();
Button.classList.add('btn-secondary');
            }
        }

        // Handle submission of the "Create Task" form
        document.getElementById('addTaskForm').addEventListener('submit', async (e) => {
            e                showAlert(`Ad watched! You earned ${AD_REWARD_POINTS} points!`, 'success');

            } catch (error) {
                console.error('Error watching ad:', error);
                showAlert('Error loading.preventDefault();

            // Ensure wallet is connected before proceeding
            if (!tonConnectUI.account) {
                showAlert('Please connect your TON wallet first to create a task.', 'danger');
                // Optionally scroll to the ad. Please try again.', 'danger');
            }
        }

        // Daily check-in feature
        async function dailyCheckin() {
            const today = new Date().toDateString();
            const userRef = database.ref(' wallet connection area
                document.getElementById('connectWalletButtonAddTaskWrapper').scrollIntoView({ behavior: 'smooth' });
                return;
            }

            const title = document.getElementById('newTaskTitle').value;
            const description = document.getElementById('newTaskDescription').value;
            const url = document.getElementById('newTaskUrl').value;
            const impressions = parseInt(document.getElementById('taskImpressions').value);
            const cost = (impressions / IMPusers/' + currentUser.id);
            const snapshot = await userRef.once('value');
            const userData = snapshot.val();

            if (userData.lastCheckin === today) {
                showAlert('You haveRESSIONS_TO_TON_RATE) * 0.1; // Calculate cost based on rate

            // Input validation
            if (isNaN(impressions) || impressions < 100 || impressions > 50 already checked in today!', 'danger');
                return;
            }

            // You might want to open a link or perform some action here.
            // For now, we'll simulate a short delay before crediting points.
            await new Promise(resolve => setTimeout(resolve, 1000));

            // Update user balance and record check-in date
            await userRef.update({
                balance: (userData.balance ||00) {
                showAlert('Please enter a valid number of impressions between 100 and 5000.', 'danger');
                return;
            }
            if (!title || !description || !url 0) + CHECKIN_REWARD_POINTS,
                totalEarned: (userData.totalEarned || 0) + CHECKIN_REWARD_POINTS,
                lastCheckin: today
            });

            showAlert(`Daily check-in completed! You earned ${CHECKIN_REWARD_POINTS} points!`, 'success');

            // Update the button state
            const dailyCheckinButton = document.querySelector('.btn-success[onclick="dailyCheckin()"]');
            if (dailyCheckinButton) {
                dailyCheckinButton.textContent = 'Checked In!';
                dailyCheckinButton.disabled = true;
                dailyCheckinButton.classList.remove('btn-success');
                dailyCheckinButton.classList.add('btn-secondary');
            }
        }

        // Handle submission of the "Create Task" form
        document.getElementById('addTaskForm').addEventListener(') {
                showAlert('Please fill in all task details.', 'danger');
                return;
            }

            const createTaskButton = document.getElementById('createTaskButton');
            createTaskButton.disabled = true;
            createTaskButton.innerHTML = '<div class="loading"></div> Processing...';

            try {
                // Prepare TON transaction
                const transaction = {
                    validUntil: Math.floor(Date.now() / 1000) + 60, // Transaction is valid for 60 seconds
                    messages: [{
                        address: "UQDLsNfQBwWXD9aaNxNS3udGo-9o8ybrlKmmbI5gjjRfs17M", // Replace with your contract or wallet address for receiving funds
                        amount: Math.floor(cost * 1e9).toString() // Amount in nanoTON (1 TON = 1e9 nanoTON)
                    }]
                };

                // Send transaction via TON Connect UI
                const result = await tonConnectUI.sendTransaction(transaction);

                if (result && result.boc) { // If transaction was successful
                    const tasksubmit', async (e) => {
            e.preventDefault();

            // Ensure wallet is connected before proceeding
            if (!tonConnectUI.account) {
                showAlert('Please connect your TON wallet first to create a task.', 'danger');Data = {
                        title,
                        description,
                        url,
                        reward: 100, // Default reward points per task
                        impressions,
                        remainingImpressions: impressions,
                        createdBy: currentUser.id,

                // Optionally scroll to the wallet connection area
                document.getElementById('connectWalletButtonAddTaskWrapper').scrollIntoView({ behavior: 'smooth' });
                return;
            }

            const title = document.getElementById('                        createdAt: Date.now(),
                        status: 'active',
                        transactionHash: result.boc // Store the transaction hash for verification if needed
                    };

                    // Save task details to Firebase
                    await database.newTaskTitle').value;
            const description = document.getElementById('newTaskDescription').value;
            const url = document.getElementById('newTaskUrl').value;
            const impressions = parseInt(document.getElementById('taskImpressions').value);
            const cost = (impressions / IMPRESSIONS_TO_TON_RATE) * 0.1; // Calculate cost based on rate

            // Input validation
            if (isNaN(impressions) ||ref('tasks').push(taskData);

                    document.getElementById('addTaskForm').reset(); // Reset form
                    document.getElementById('totalCost').textContent = '0'; // Reset cost display
                    showAlert('Task created successfully! Transaction confirmed impressions < 100 || impressions > 5000) {
                showAlert('Please enter a valid number of impressions between 100 and 5000.', 'danger');
                return;
            .', 'success');
                    loadUserTasks(); // Reload user's created tasks
                } else {
                    showAlert('Transaction failed or was cancelled. Task not created.', 'danger');
                }

            } catch (error) {
                console.error('Error creating task:', error);
                if (error.message && error.message.includes('User rejects')) {
                    showAlert('Transaction was cancelled by user.', 'warning');
                } else {}
            if (!title || !description || !url) {
                showAlert('Please fill in all task details.', 'danger');
                return;
            }

            const createTaskButton = document.getElementById('createTaskButton
                    showAlert('Error creating task. Please check your wallet connection and try again.', 'danger');
                }
            } finally {
                createTaskButton.disabled = false;
                createTaskButton.innerHTML = '<span');
            createTaskButton.disabled = true;
            createTaskButton.innerHTML = '<div class="loading"></div> Processing...';

            try {
                // Prepare TON transaction
                const transaction = {
                    valid class="material-icons">payment</span> Create & Pay';
            }
        });

        // Update total cost display for task creation as impressions change
        document.getElementById('taskImpressions').addEventListener('input', (e) => {
            Until: Math.floor(Date.now() / 1000) + 60, // Transaction is valid for 60 seconds
                    messages: [{
                        address: "UQDLsNfQBwconst impressions = parseInt(e.target.value) || 0;
            const cost = (impressions / IMPRESSIONS_TO_TON_RATE) * 0.1;
            document.getElementById('totalCostWXD9aaNxNS3udGo-9o8ybrlKmmbI5gjjRfs17M", // Replace with your contract or wallet address for receiving funds
                        amount: Math.floor(cost * 1').textContent = cost.toFixed(3);
        });

        // Load the tasks created by the current user
        function loadUserTasks() {
            if (!currentUser) return;

            const myTasksGrid = document.getElementById('myTasksGride9).toString() // Amount in nanoTON (1 TON = 1e9 nanoTON)
                    }]
                };

                // Send transaction via TON Connect UI
                const result = await tonConnectUI.sendTransaction');

            // Query Firebase for tasks created by the current user
            database.ref('tasks').orderByChild('createdBy').equalTo(currentUser.id).on('value', (snapshot) => {
                myTasksGrid.innerHTML = '';(transaction);

                if (result && result.boc) { // If transaction was successful
                    const taskData = {
                        title,
                        description,
                        url,
                        reward: 100,
                const tasks = snapshot.val();

                if (!tasks) {
                    myTasksGrid.innerHTML = '<p style="text-align: center; color: var(--text-light);">No tasks created by you yet // Default reward points per task
                        impressions,
                        remainingImpressions: impressions,
                        createdBy: currentUser.id,
                        createdAt: Date.now(),
                        status: 'active',
                        transactionHash: result.</p>';
                    return;
                }

                Object.keys(tasks).forEach(taskId => {
                    const task = tasks[taskId];
                    // Ensure task has necessary properties before rendering
                    if (!task || !task.title ||.boc // Store the transaction hash for verification if needed
                    };

                    // Save task details to Firebase
                    await database.ref('tasks').push(taskData);

                    document.getElementById('addTaskForm').reset(); // Reset form
 !task.description || !task.url) {
                         console.warn("Skipping malformed user task:", taskId, task);
                         return;
                    }
                    const taskCard = createUserTaskCard(taskId, task                    document.getElementById('totalCost').textContent = '0'; // Reset cost display
                    showAlert('Task created successfully! Transaction confirmed.', 'success');
                    loadUserTasks(); // Reload user's created tasks
                } else {
                    showAlert(');
                    myTasksGrid.appendChild(taskCard);
                });
            });
        }

        // Create a task card HTML element for the user's own tasks
        function createUserTaskCard(taskId, task) {Transaction failed or was cancelled. Task not created.', 'danger');
                }

            } catch (error) {
                console.error('Error creating task:', error);
                if (error.message && error.message.
            const card = document.createElement('div');
            card.className = 'task-card';

            const isTaskCompleted = task.remainingImpressions <= 0;
            // Ensure impressions is not zero to avoidincludes('User rejects')) {
                    showAlert('Transaction was cancelled by user.', 'warning');
                } else {
                    showAlert('Error creating task. Please check your wallet connection and try again.', 'danger');
                }
 division by zero
            const progressPercentage = (task.impressions > 0) ? ((task.impressions - (task.remainingImpressions || task.impressions)) / task.impressions) * 100 :            } finally {
                createTaskButton.disabled = false;
                createTaskButton.innerHTML = '<span class="material-icons">payment</span> Create & Pay';
            }
        });

        // Update total cost display for task creation 0;


            card.innerHTML = `
                <div class="task-header">
                    <div class="task-title">${task.title}</div>
                    <div class="task-reward">${task.remaining as impressions change
        document.getElementById('taskImpressions').addEventListener('input', (e) => {
            const impressions = parseInt(e.target.value) || 0;
            const cost = (impressions /Impressions || 0}/${task.impressions}</div>
                </div>
                <div class="task-description">${task.description}</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                </div>
                <div class="task-actions">
                    ${isTaskCompleted ?
                        `<button class="btn btn-danger" onclick="deleteUserTask IMPRESSIONS_TO_TON_RATE) * 0.1;
            document.getElementById('totalCost').textContent = cost.toFixed(3);
        });

        // Load the tasks created by the current user
('${taskId}')">
                            <span class="material-icons">delete</span>
                            Delete
                        </button>` :
                        `<span style="color: var(--text-light); font-size: 12px;">        function loadUserTasks() {
            if (!currentUser) return;

            const myTasksGrid = document.getElementById('myTasksGrid');

            // Query Firebase for tasks created by the current user
            database.ref('tasks').orderByChildActive</span>`
                    }
                </div>
            `;

            return card;
        }

        // Delete a user-created task
        async function deleteUserTask(taskId) {
            if (confirm('Are you sure you('createdBy').equalTo(currentUser.id).on('value', (snapshot) => {
                myTasksGrid.innerHTML = '';
                const tasks = snapshot.val();

                if (!tasks) {
                    myTasksGrid.innerHTML = want to delete this task? This action cannot be undone.')) {
                try {
                    await database.ref('tasks/' + taskId).remove();
                    showAlert('Task deleted successfully!', 'success');
                } catch ( '<p style="text-align: center; color: var(--text-light);">No tasks created by you yet.</p>';
                    return;
                }

                Object.keys(tasks).forEach(taskId => {
error) {
                    console.error('Error deleting task:', error);
                    showAlert('Error deleting task. Please try again.', 'danger');
                }
            }
        }

        // Handle referral logic when a new                    const task = tasks[taskId];
                    // Ensure task has necessary properties before rendering
                    if (!task || !task.title || !task.description || !task.url) {
                         console.warn("Skipping user joins via a referral link
        async function handleReferral(referrerId) {
            if (!currentUser || currentUser.id.toString() === referrerId) {
                return; // Do nothing if no current user or referred by self
            }

            try {
                const newUserRef = database.ref('users/' + currentUser.id);
                const newUserSnapshot = await newUserRef.once('value');

                // Only process if the new user doesn't exist malformed user task:", taskId, task);
                         return;
                    }
                    const taskCard = createUserTaskCard(taskId, task);
                    myTasksGrid.appendChild(taskCard);
                });
            });
 yet
                if (!newUserSnapshot.exists()) {
                    const referrerUserRef = database.ref('users/' + referrerId);
                    const referrerUserSnapshot = await referrerUserRef.once('value');

                    if (        }

        // Create a task card HTML element for the user's own tasks
        function createUserTaskCard(taskId, task) {
            const card = document.createElement('div');
            card.className = 'referrerUserSnapshot.exists()) {
                        // Update referrer's stats and grant bonus
                        await referrerUserRef.transaction((referrerData) => {
                            if (referrerData) {
                                referrerData.referrals = (referrerData.task-card';

            const isTaskCompleted = task.remainingImpressions <= 0;
            // Ensure impressions is not zero to avoid division by zero
            const progressPercentage = (task.impressions > 0)referrals || 0) + 1;
                                referrerData.balance = (referrerData.balance || 0) + REFERRAL_BONUS_POINTS;
                                referrerData.totalEarned = (referrerData.totalEarned || 0) + REFERRAL_BONUS_POINTS;
                            }
                            return referrerData;
                        });

                        // Record the referral in the referrer's referrals list
                        await database.ref('referrals/' + ? ((task.impressions - (task.remainingImpressions || task.impressions)) / task.impressions) * 100 : 0;


            card.innerHTML = `
                <div class="task-header referrerId + '/' + currentUser.id).set({
                            userId: currentUser.id,
                            username: currentUser.username,
                            joinedAt: Date.now(),
                            completed: true
                        });

                        showAlert(`Welcome! You'">
                    <div class="task-title">${task.title}</div>
                    <div class="task-reward">${task.remainingImpressions || 0}/${task.impressions}</div>
                </div>
                <div class="task-description">${task.description}</div>
                <div class="progress-bar">
                    <div class="progress-fill" style="width: ${progressPercentage}%"></div>
                </div>
                <div class="task-actionsve been referred by user ID: ${referrerId}. Your referrer has been rewarded!`, 'success');
                    }
                }
            } catch (error) {
                console.error('Error handling referral:', error);
                showAlert('Error processing">
                    ${isTaskCompleted ?
                        `<button class="btn btn-danger" onclick="deleteUserTask('${taskId}')">
                            <span class="material-icons">delete</span>
                            Delete
                        </button>` referral link. Please try again.', 'danger');
            }
        }

        // Load the current user's referral list and earnings
        function loadReferrals() {
            if (!currentUser) return;

            const :
                        `<span style="color: var(--text-light); font-size: 12px;">Active</span>`
                    }
                </div>
            `;

            return card;
        }

        // Delete a user referralList = document.getElementById('referralList');
            let totalReferralEarnings = 0;

            database.ref('referrals/' + currentUser.id).on('value', (snapshot) => {
                refer-created task
        async function deleteUserTask(taskId) {
            if (confirm('Are you sure you want to delete this task? This action cannot be undone.')) {
                try {
                    await database.refralList.innerHTML = '';
                const referrals = snapshot.val();

                if (!referrals) {
                    referralList.innerHTML = '<p style="text-align: center; color: var(--text-light);">No referrals yet('tasks/' + taskId).remove();
                    showAlert('Task deleted successfully!', 'success');
                } catch (error) {
                    console.error('Error deleting task:', error);
                    showAlert('Error deleting task. Please.</p>';
                    document.getElementById('totalReferrals').textContent = '0';
                    document.getElementById('referralEarnings').textContent = '0';
                    return;
                }

                const referralIds = Object.keys(referrals);
                document.getElementById('totalReferrals').textContent = formatNumber(referralIds.length);

                referralIds.forEach(referredUserId => {
                    const referral = referrals[referredUserId];
                    total try again.', 'danger');
                }
            }
        }

        // Handle referral logic when a new user joins via a referral link
        async function handleReferral(referrerId) {
            if (!currentUser || currentUser.id.toStringReferralEarnings += REFERRAL_BONUS_POINTS;

                    const referralItem = document.createElement('div');
                    referralItem.className = 'history-item';
                    referralItem.innerHTML = `
                        () === referrerId) {
                return; // Do nothing if no current user or referred by self
            }

            try {
                const newUserRef = database.ref('users/' + currentUser.id);
                const<div>
                            <strong>${referral.username || 'User'}</strong>
                            <div style="font-size: 12px; color: var(--text-light);">
                                Joined: ${new Date(referral.joinedAt).toLocale newUserSnapshot = await newUserRef.once('value');

                // Only process if the new user doesn't exist yet
                if (!newUserSnapshot.exists()) {
                    const referrerUserRef = database.ref('users/'DateString()}
                            </div>
                        </div>
                        <div class="history-status status-completed">Referred</div>
                    `;
                    referralList.appendChild(referralItem);
                });

                document.getElementById('referralEarnings + referrerId);
                    const referrerUserSnapshot = await referrerUserRef.once('value');

                    if (referrerUserSnapshot.exists()) {
                        // Update referrer's stats and grant bonus
                        await referrerUserRef.transaction((').textContent = formatNumber(totalReferralEarnings);
            });
        }

        // Claim referral rewards (automated, so this is informational)
        async function claimReferralRewards() {
            showAlert('Referral rewards are automatically creditedreferrerData) => {
                            if (referrerData) {
                                referrerData.referrals = (referrerData.referrals || 0) + 1;
                                referrerData.balance = (referrerData.balance || 0 when a new user joins via your link!', 'success');
        }

        // Copy the user's referral link to the clipboard
        function copyReferralLink() {
            const botUsername = 'adflareprobot) + REFERRAL_BONUS_POINTS;
                                referrerData.totalEarned = (referrerData.totalEarned || 0) + REFERRAL_BONUS_POINTS;
                            }
                            return referrerData;'; // Replace with your bot's username
            const link = `https://t.me/${botUsername}/app?startapp=ref_${currentUser.id}`;
            navigator.clipboard.writeText(link).then(() => {

                        });

                        // Record the referral in the referrer's referrals list
                        await database.ref('referrals/' + referrerId + '/' + currentUser.id).set({
                            userId: currentUser.id,
                                            showAlert('Referral link copied to clipboard!', 'success');
            }).catch(err => {
                console.error('Failed to copy referral link: ', err);
                showAlert('Failed to copy link. Please copy it manually.', 'danger');
            });
        }

        // Show the withdrawal modal
        function showWithdrawModal() {
            if (!currentUser) {
                showAlert('Please log in to withdraw points.', 'danger');
username: currentUser.username,
                            joinedAt: Date.now(),
                            completed: true
                        });

                        showAlert(`Welcome! You've been referred by user ID: ${referrerId}. Your referrer has been rewarded!`, 'success');
                    }
                }
            } catch (error) {
                console.error('Error handling referral:', error);
                showAlert('Error processing referral link. Please try again.', 'danger');
            }
        }

                return;
            }
            // Check if user has enough TON (this will be updated when wallet is connected)
            updateWithdrawModalInfo(); // Ensure info is up-to-date
            document.getElementById('withdrawModal').        // Load the current user's referral list and earnings
        function loadReferrals() {
            if (!currentUser) return;

            const referralList = document.getElementById('referralList');
            let totalReferralstyle.display = 'block';
        }

        // Update the withdrawal modal content, including TON balance and minimum withdrawal
        function updateWithdrawModalInfo() {
            const connectedWallet = tonConnectUI.account;
            const userTonBalanceElement = document.getElementById('userTonBalance');
            const minWithdrawTonElement = document.getElementById('minWithdrawTon');
            const withdrawAmountInput = document.getElementById('withdrawAmount');
            const requestWithdrawButton = document.getElementByIdEarnings = 0;

            database.ref('referrals/' + currentUser.id).on('value', (snapshot) => {
                referralList.innerHTML = '';
                const referrals = snapshot.val();

                if (!referrals) {
                    referralList.innerHTML = '<p style="text-align: center; color: var(--text-light);">No referrals yet.</p>';
                    document.getElementById('totalReferrals').textContent = '0';
                    document.('requestWithdrawButton');

            if (userTonBalanceElement) userTonBalanceElement.textContent = connectedWallet ? 'Loading...' : 'N/A'; // Placeholder

            if (minWithdrawTonElement) minWithdrawTonElement.textContent = MINgetElementById('referralEarnings').textContent = '0';
                    return;
                }

                const referralIds = Object.keys(referrals);
                document.getElementById('totalReferrals').textContent = formatNumber(referralIds.length);_WITHDRAW_TON.toFixed(1);

            if (connectedWallet) {
                // You would typically fetch the actual TON balance from the connected wallet here.
                // For now, we'll use a placeholder or

                referralIds.forEach(referredUserId => {
                    const referral = referrals[referredUserId];
                    totalReferralEarnings += REFERRAL_BONUS_POINTS;

                    const referralItem = document.createElement('div'); assume it's managed by TON Connect UI if possible.
                // If direct balance fetching is needed, it requires more advanced TON SDK integration.
                userTonBalanceElement.textContent = '0.0000000
                    referralItem.className = 'history-item';
                    referralItem.innerHTML = `
                        <div>
                            <strong>${referral.username || 'User'}</strong>
                            <div style="font-size: 12px; color: var(--text-light);">
                                Joined: ${new Date(referral.joinedAt).toLocaleDateString()}
                            </div>
                        </div>
                        <div class="history-status status-completed">Referred0'; // Placeholder, replace with actual balance if available
            } else {
                 userTonBalanceElement.textContent = 'N/A';
            }

            // Disable input and button if not connected or below minimum
            if (!connectedWallet) {
                withdrawAmountInput.disabled = true;
                requestWithdrawButton.disabled = true;
            } else {
                withdrawAmountInput.disabled = false;
                requestWithdrawButton.disabled = false; // Will</div>
                    `;
                    referralList.appendChild(referralItem);
                });

                document.getElementById('referralEarnings').textContent = formatNumber(totalReferralEarnings);
            });
        }

        // Claim referral rewards (automated, so this is informational)
        async function claimReferralRewards() {
            showAlert('Referral rewards are automatically credited when a new user joins via your link!', 'success');
        }

        // Copy the user's referral link to the clipboard
        function copyReferralLink() {
            const botUsername = 'adflareprobot'; // Replace with your bot's username
            const link = `https://t.me/${ be further validated on submit
            }
            updateWithdrawTonAmount(); // Recalculate equivalent points and check minimum
        }


        // Handle submission of the withdrawal form
        document.getElementById('withdrawForm').addEventListener('submit', async (ebotUsername}/app?startapp=ref_${currentUser.id}`;
            navigator.clipboard.writeText(link).then(() => {
                showAlert('Referral link copied to clipboard!', 'success');
            }).catch() => {
            e.preventDefault();

            const tonAddress = document.getElementById('tonAddress').value.trim();
            const withdrawAmount = parseFloat(document.getElementById('withdrawAmount').value);

            // Basic validation for TON address
            if (!tonAddress || (!tonAddress.startsWith('UQ') && !tonAddress.startsWith('EQ'))) {
                showAlert('Please enter a valid TON address.', 'danger');
                return;
            }

            // Validate amounterr => {
                console.error('Failed to copy referral link: ', err);
                showAlert('Failed to copy link. Please copy it manually.', 'danger');
            });
        }

        // Show the withdrawal modal against minimum
            if (withdrawAmount < MIN_WITHDRAW_TON) {
                showAlert(`Minimum withdrawal amount is ${MIN_WITHDRAW_TON.toFixed(1)} TON!`, 'danger');
                return;
            }

            // Ensure wallet is connected and address is correct
            if (!tonConnectUI.account) {
                 showAlert('Please connect your TON wallet to proceed with withdrawal.', 'danger');
                 return;
            }
        function showWithdrawModal() {
            if (!currentUser) {
                showAlert('Please log in to withdraw points.', 'danger');
                return;
            }
            // Ensure wallet is connected before checking balance for withdrawal
            if (!ton
            if (tonAddress !== tonConnectUI.account.address) {
                 showAlert('The displayed TON address does not match your connected wallet. Please reconnect if necessary.', 'danger');
                 return;
            }

            ConnectUI.account) {
                showAlert('Please connect your TON wallet to withdraw.', 'danger');
                return;
            }

            const minPointsForWithdrawal = MIN_TON_WITHDRAWAL * POINTS_TO_TON_RATE// --- Calculate points required ---
            const pointsRequired = withdrawAmount * POINTS_TO_TON_RATE;
            if (userBalancePoints < pointsRequired) {
                showAlert('Insufficient points balance!', 'danger');
                ; // Calculate minimum points required
            if (userBalance < minPointsForWithdrawal) {
                showAlert(`Minimum withdrawal is ${MIN_TON_WITHDRAWAL} TON (${formatNumber(minPointsForWithdrawal)} points)!return;
            }

            try {
                // Prepare withdrawal data to save in Firebase
                const withdrawalData = {
                    userId: currentUser.id,
                    username: currentUser.username,
                    tonAddress,
`, 'danger');
                return;
            }
            document.getElementById('withdrawModal').style.display = 'block';
            updateWalletUI(); // Ensure wallet status is correctly displayed inside modal
            updateWithdrawTonAmount();                    amountTON: withdrawAmount, // Storing amount in TON
                    pointsDeducted: pointsRequired,
                    status: 'pending',
                    createdAt: Date.now()
                };

                // Save withdrawal request to Firebase
 // Calculate initial TON amount if input has value
        }

        // Handle submission of the withdrawal form
        document.getElementById('withdrawForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const                await database.ref('withdrawals').push(withdrawalData);

                // Deduct points from user balance atomically
                const userRef = database.ref('users/' + currentUser.id);
                await userRef.transaction((userData) tonAddress = document.getElementById('tonAddress').value.trim();
            const withdrawAmountTon = parseFloat(document.getElementById('withdrawAmount').value); // Withdrawal amount in TON

            // Basic validation for TON address
            if (!tonAddress || => {
                    if (userData) {
                        userData.balance = Math.max(0, (userData.balance || 0) - pointsRequired);
                    }
                    return userData;
                });

                closeModal('withdrawModal'); // Close the modal
                document.getElementById('withdrawForm').reset(); // Reset form fields
                showAlert(`Withdrawal request of ${withdrawAmount.toFixed(8)} TON submitted successfully! It will be processed shortly.`, 'success');
 (!tonAddress.startsWith('UQ') && !tonAddress.startsWith('EQ'))) { // Allow EQ for newer addresses too
                showAlert('Please enter a valid TON address.', 'danger');
                return;
            }
            //                loadWithdrawalHistory(); // Refresh the withdrawal history display

            } catch (error) {
                console.error('Error submitting withdrawal:', error);
                showAlert('Error submitting withdrawal. Please try again.', 'danger');
 Validate amount against minimum
            if (withdrawAmountTon < MIN_TON_WITHDRAWAL) {
                showAlert(`Minimum withdrawal amount is ${MIN_TON_WITHDRAWAL} TON!`, 'danger');
                return;
            }

            // Calculate points required for withdrawal
            const requiredPoints = withdrawAmountTon * POINTS_TO_TON_RATE;

            // Validate against user's balance in points
            if (userBalance < requiredPoints) {            }
        });

        // Update TON receive amount and equivalent points dynamically
        document.getElementById('withdrawAmount').addEventListener('input', updateWithdrawTonAmount);

        function updateWithdrawTonAmount() {
            const amountInput = document.getElementById('withdrawAmount');
            const withdrawAmount = parseFloat(amountInput.value) || 0;
            const pointsEquivalentElement = document.getElementById('pointsEquivalent');

            // Check minimum TON withdrawal
            if (withdrawAmount <
                showAlert('Insufficient balance in points!', 'danger');
                return;
            }

            // Ensure wallet is connected and address is correct (redundant check, but good practice)
            if (!tonConnectUI.account) { MIN_WITHDRAW_TON) {
                pointsEquivalentElement.textContent = '0'; // Display zero equivalent points
                if (requestWithdrawButton) requestWithdrawButton.disabled = true; // Disable button if below minimum
                return;
            
                 showAlert('Please connect your TON wallet to proceed with withdrawal.', 'danger');
                 return;
            }
            if (tonAddress !== tonConnectUI.account.address) {
                 showAlert('The displayed TON address does not match your connected} else {
                if (requestWithdrawButton) requestWithdrawButton.disabled = false; // Enable button
            }

            const pointsRequired = withdrawAmount * POINTS_TO_TON_RATE;
            if (pointsEquivalent wallet. Please reconnect if necessary.', 'danger');
                 return;
            }

            try {
                // Prepare withdrawal data to save in Firebase
                const withdrawalData = {
                    userId: currentUser.id,
                    Element) pointsEquivalentElement.textContent = formatNumber(pointsRequired);

            // Optional: Check if the user has enough points
            if (userBalancePoints < pointsRequired) {
                 // Optionally show a warning or disable button if notusername: currentUser.username,
                    tonAddress,
                    amount: requiredPoints, // Store in points
                    tonAmount: withdrawAmountTon, // Store in TON
                    status: 'pending',
                    createdAt: Date.now() enough points
                 if (requestWithdrawButton) requestWithdrawButton.disabled = true;
                 // showAlert('You do not have enough points for this withdrawal.', 'warning'); // Or show a transient alert
            } else {
                 if (requestWithdraw
                };

                // Save withdrawal request to Firebase
                await database.ref('withdrawals').push(withdrawalData);

                // Deduct points from user balance atomically
                const userRef = database.ref('users/' + currentUser.id);
                await userRef.transaction((userData) => {
                    if (userData) {
                        userData.balance = Math.max(0, (userData.balance || 0) - requiredPoints);
                    }
                    return userData;
                });

                closeModal('withdrawModal'); // Close the modal
                document.getElementById('withdrawForm').reset(); // Reset form fields
                showAlert('Withdrawal request submitted successfully! It will be processed shortlyButton) requestWithdrawButton.disabled = false;
            }
        }

        // Update the TON conversion text in the profile section
        function updateProfileTonConversion() {
            const profileCurrentPointsElement = document.getElementById('profileCurrentPoints');
            const profileEstimatedTonElement = document.getElementById('profileEstimatedTon');
            const minWithdrawPointsProfileElement = document.getElementById('minWithdrawPointsProfile');

            if (profileCurrentPointsElement) profileCurrentPointsElement.textContent = formatNumber(userBalancePoints);

            if (profileEstimatedTonElement) {
                const estimatedTon = (userBalancePoints / POINTS_TO_TON_RATE);
                profileEstimatedTonElement.textContent = estimated.', 'success');
                loadWithdrawalHistory(); // Refresh the withdrawal history display

            } catch (error) {
                console.error('Error submitting withdrawal:', error);
                showAlert('Error submitting withdrawal. Please try again.', 'dangerTon.toFixed(8);
            }

            if (minWithdrawPointsProfileElement) {
                minWithdrawPointsProfileElement.textContent = MIN_WITHDRAW_TON.toFixed(1);
            }
        }


        // Load the user's withdrawal history
        function loadWithdrawalHistory() {
            if (!currentUser) return;

            const withdrawalHistory = document.getElementById('withdrawalHistory');

            database.ref('withdrawals')
                .orderByChild('userId').equalTo');
            }
        });

        // Update TON receive amount and points required dynamically
        document.getElementById('withdrawAmount').addEventListener('input', updateWithdrawTonAmount);
        document.getElementById('minWithdrawTon').textContent = MIN(currentUser.id) // Filter by current user
                .limitToLast(10) // Display the last 10 withdrawals
                .on('value', (snapshot) => {
                    withdrawalHistory.innerHTML = '';_TON_WITHDRAWAL; // Set min TON value

        function updateWithdrawTonAmount() {
            const amountInput = document.getElementById('withdrawAmount');
            const withdrawAmountTon = parseFloat(amountInput.value)
                    const withdrawals = snapshot.val();

                    if (!withdrawals) {
                        withdrawalHistory.innerHTML = '<p style="text-align: center; color: var(--text-light);">No withdrawal history yet.</p>';
 || 0;
            const pointsRequiredElement = document.getElementById('pointsRequired');

            // Calculate points required
            const requiredPoints = withdrawAmountTon * POINTS_TO_TON_RATE;

            // Update points required display
            if (pointsRequiredElement) {
                pointsRequiredElement.textContent = formatNumber(requiredPoints);
            }

            // Check if minimum withdrawal is met
            if (withdrawAmountTon < MIN_TON_WITHDRAWAL) {
                        return;
                    }

                    // Sort withdrawals by timestamp (most recent first)
                    const sortedWithdrawals = Object.entries(withdrawals)
                        .sort(([, a], [, b]) => b.createdAt - a.createdAt);

                    sortedWithdrawals.forEach(([key, withdrawal]) => {
                        const historyItem = document.createElement('div');
                        historyItem.className = 'history-item';

                        const statusClass = `status-${withdrawal.status}`;
                        const statusText = withdrawal.status.charAt(0).toUpperCase() + withdrawal.status.slice(1);

                        historyItem.innerHTML = `
                            <div>
                                <strong>${                // Optionally disable button or show warning if needed, but validation is also on submit
            }
        }

        // Update the TON conversion text in the profile section
        function updateProfileTonConversion() {
            const profileCurrentwithdrawal.amountTON.toFixed(8)} TON</strong>
                                <div style="font-size: 12px; color: var(--text-light);">
                                    ${withdrawal.pointsDeducted} Points • ${newPoints = document.getElementById('profileCurrentPoints');
            const profileEstimatedTon = document.getElementById('profileEstimatedTon');

            if (profileCurrentPoints) profileCurrentPoints.textContent = formatNumber(userBalance);
            if ( Date(withdrawal.createdAt).toLocaleDateString()}
                                </div>
                            </div>
                            <div class="history-status ${statusClass}">${statusText}</div>
                        `;
                        withdrawalHistory.appendChild(historyItem);
                    });
profileEstimatedTon) {
                const estimatedTon = (userBalance / POINTS_TO_TON_RATE);
                profileEstimatedTon.textContent = estimatedTon.toFixed(8); // Display with 8 decimal places for TON
                });
        }

        // Function to open the TON Connect UI modal for wallet connection
        async function connectToWallet() {
            try {
                await tonConnectUI.openModal(); // This opens the default TON Connect UI modal
            }
        }

        // Load the user's withdrawal history
        function loadWithdrawalHistory() {
            if (!currentUser) return;

            const withdrawalHistory = document.getElementById('withdrawalHistory');

            database            } catch (error) {
                console.error("Error connecting to wallet:", error);
                showAlert('Error connecting to wallet. Please ensure you have a TON wallet installed and try again.', 'danger');
            }
.ref('withdrawals')
                .orderByChild('userId').equalTo(currentUser.id) // Filter by current user
                .limitToLast(10) // Display the last 10 withdrawals
                .on('        }

        // Navigate between different sections of the app
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => {
                section.style.displayvalue', (snapshot) => {
                    withdrawalHistory.innerHTML = '';
                    const withdrawals = snapshot.val();

                    if (!withdrawals) {
                        withdrawalHistory.innerHTML = '<p style="text-align: center; color: var = 'none';
            });

            // Show the requested section
            document.getElementById(sectionName + 'Section').style.display = 'block';

            // Update active state in bottom navigation
            document.querySelectorAll('.nav-item').forEach(--text-light);">No withdrawal history yet.</p>';
                        return;
                    }

                    // Sort withdrawals by timestamp (most recent first)
                    const sortedWithdrawals = Object.entries(withdrawals)
                        .sort(([, a(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                if (item.getAttribute('onclick').includes(`showSection('${sectionName}')`)) {
                    item.classList.add('active');
                }
            });

            // Special handling for section transitions if needed
            if (sectionName === 'addTask' || sectionName === 'profile')], [, b]) => b.createdAt - a.createdAt);

                    sortedWithdrawals.forEach(([key, withdrawal]) => {
                        const historyItem = document.createElement('div');
                        historyItem.className = 'history-item';

 {
                updateWalletUI(); // Ensure wallet status is correct when navigating to these sections
            }
             if (sectionName === 'profile') {
                updateProfileTonConversion(); // Update TON conversion info when profile is shown
            }                        const statusClass = `status-${withdrawal.status}`;
                        const statusText = withdrawal.status.charAt(0).toUpperCase() + withdrawal.status.slice(1);

                        historyItem.innerHTML = `
                            <div>
        }

        // Switch between tabs within the tasks section
        function showTaskTab(event, tabName) {
            // Deactivate all tabs and content
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList
                                <strong>${withdrawal.tonAmount.toFixed(8)} TON</strong>
                                <div style="font-size: 11px; color: var(--text-light);">
                                    (${formatNumber(withdrawal.amount)}.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });

            // Activate the clicked tab and its content
             Points) • ${new Date(withdrawal.createdAt).toLocaleDateString()}
                                </div>
                            </div>
                            <div class="history-status ${statusClass}">${statusText}</div>
                        `;
                        withdrawalHistory.appendChild(historyItemevent.target.classList.add('active');
            document.getElementById(tabName + 'Tasks').classList.add('active');
        }

        // Close a modal by its ID
        function closeModal(modalId));
                    });
                });
        }

        // Function to open the TON Connect UI modal for wallet connection
        async function connectToWallet() {
            try {
                await tonConnectUI.openModal(); // This opens {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
                // Reset form fields in modal if necessary upon closing
                if (modal the default TON Connect UI modal
            } catch (error) {
                console.error("Error connecting to wallet:", error);
                showAlert('Error connecting to wallet. Please ensure you have a TON wallet installed and try again.',Id === 'withdrawModal') {
                    document.getElementById('withdrawForm').reset();
                    document.getElementById('pointsEquivalent').textContent = '0'; // Reset equivalent points display
                    updateWithdrawModalInfo(); // Re-apply 'danger');
            }
        }

        // Navigate between different sections of the app
        function showSection(sectionName) {
            // Hide all sections
            document.querySelectorAll('.section').forEach(section => { initial state
                }
            }
        }

        // Display an alert message to the user
        function showAlert(message, type) {
            const alertContainer = document.querySelector('.container'); // Prepend alert to the main container
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <span class="material-icons">${type === 'success' ? '
                section.style.display = 'none';
            });

            // Show the requested section
            document.getElementById(sectionName + 'Section').style.display = 'block';

            // Update active state in bottomcheck_circle' : type === 'warning' ? 'warning' : 'error'}</span>
                ${message}
            `;

            alertContainer.prepend(alert); // Add alert at the top

            setTimeout(() => { navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelectorAll('.nav-item').forEach(item => {
                if ( // Remove alert after a few seconds
                alert.remove();
            }, 5000);
        }

        // Format numbers to use K, M, B, T suffixes for large values
        function formatNumberitem.getAttribute('onclick').includes(`showSection('${sectionName}')`)) {
                    item.classList.add('active');
                }
            });

            // Special handling for section transitions if needed
            if (section(num) {
            if (num === null || num === undefined) return '0';
            num = Number(num);

            if (num >= 1e12) {
                return (num / Name === 'addTask' || sectionName === 'profile') {
                updateWalletUI(); // Ensure wallet status is correct when navigating to these sections
            }
             if (sectionName === 'profile') {
                updateProfile1e12).toFixed(1).replace(/\.0$/, '') + 'T';
            } else if (num >= 1e9) {
                return (num / 1e9).toFixed(1).replace(/\.0TonConversion(); // Update TON conversion info when profile is shown
            }
        }

        // Switch between tabs within the tasks section
        function showTaskTab(event, tabName) {
            // Deactivate all tabs and content$/, '') + 'B';
            } else if (num >= 1e6) {
                return (num / 1e6).toFixed(1).replace(/\.0$/, '') + 'M';
            }
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove else if (num >= 1e3) {
                return (num / 1e3).toFixed(1).replace(/\.0$/, '') + 'K';
            }
            return num.toString();
        ('active');
            });

            // Activate the clicked tab and its content
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tasks').classList.add('active');
        }

        // Theme toggle functionality (currently informational)
        function toggleTheme() {
            showAlert('Red Moon theme is the current and only theme!', 'success');
        }

        // Initialize the application when the DOM is}

        // Close a modal by its ID
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none ready
        document.addEventListener('DOMContentLoaded', () => {
            initTelegramWebApp(); // Initialize Telegram Web App context
            showSection('home'); // Set default section to home

            // TON Connect UI configuration - Note: button';
                // Reset form fields in modal if necessary upon closing
                if (modalId === 'withdrawModal') {
                    document.getElementById('withdrawForm').reset();
                    // Reset points required as well, it will beRootId is less critical now as we manually manage buttons
            tonConnectUI.buttonRootId = 'ton-connect-button-container'; // Keep this for TON Connect UI's internal use if necessary

            // Listen for changes in wallet connection status and update the UI accordingly
            tonConnectUI.onStatusChange(wallet => {
                updateWalletUI();
                updateWithdrawModalInfo(); // Update modal when connection status changes
            });

            // Set the minimum withdrawal recalculated on input anyway
                    document.getElementById('pointsRequired').textContent = '0';
                }
            }
        }

        // Display an alert message to the user
        function showAlert(message, type) {
            const alertContainer TON display
            document.getElementById('minWithdrawTon').textContent = MIN_WITHDRAW_TON.toFixed(1);
        });

        // Close modals if the user clicks outside the modal content area
        window.addEventListener('click', ( = document.querySelector('.container'); // Prepend alert to the main container
            const alert = document.createElement('div');
            alert.className = `alert alert-${type}`;
            alert.innerHTML = `
                <span class="material-icons">${type === 'success' ? 'check_circle' : type === 'warning' ? 'warning' : 'error'}</span>
                ${message}
            `;

            alertContainer.prepend(alert); // Add alert at the top

            setTimeout(() => { // Remove alert after a few seconds
                alert.remove();
            }, 5000);
        }

        // Format numbers to use K, M, B, T suffixes for large values
        function formatNumber(num) {
            if (num === null || num === undefined) return '0';
            num = Number(num);

            if (num >= 1e12) {
                return (num / 1e12).toFixed(1).replace(/\.0$/, '') + 'T';
            } else if (num >= 1e9) {
                return (num / 1e9).toFixed(1).replace(/\.0$/, '') + 'B';
            } else if (num >= 1e6) {
                return (num / 1e6).toFixed(1).replace(/\.0$/, '') + 'M';
            } else if (num >= 1e3) {
                return (num / 1e3).toFixed(1).replace(/\.0$/, '') + 'K';
            }
            return num.toString();
        }

        // Theme toggle functionality (currently informational)
        function toggleTheme() {
            showAlert('Red Moon theme is the current and only theme!', 'success');
        }

        // Initialize the application when the DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
            initTelegramWebApp(); // Initialize Telegram Web App context
            showSection('home'); // Set default section to home

            // TON Connect UI configuration - Note: buttonRootId is less critical now as we manually manage buttons
            tonConnectUI.buttonRootId = 'ton-connect-button-container'; // Keep this for TON Connect UI's internal use if necessary

            // Listen for changes in wallet connection status and update the UI accordingly
            tonConnectUI.onStatusChange(wallet => {
                updateWalletUI();
            });

            // Set the minimum withdrawal values
            document.getElementById('minWithdrawTon').textContent = MIN_TON_WITHDRAWAL;
            // Initial call to set points required based on min TON withdrawal
            updateWithdrawTonAmount();
        });

        // Close modals if the user clicks outside the modal content area
        window.addEventListenere) => {
            if (e.target.classList.contains('modal')) {
                closeModal(e.target.id);
            }
        });
    </script>
</body>
</html>
