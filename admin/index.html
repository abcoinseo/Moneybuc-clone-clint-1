<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EarnFlux - Admin Dashboard (INSECURE)</title>
    <!-- Include your styles and Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <style>
        /* Add styles for tables, buttons, etc. */
        body { font-family: 'Inter', sans-serif; background-color: var(--dark); color: var(--text); padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        h1, h2 { color: var(--primary); margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        th, td { border: 1px solid var(--border); padding: 10px; text-align: left; }
        th { background-color: var(--dark-secondary); }
        .btn { /* Your existing button styles */ }
        .btn-danger { background: var(--danger); }
        .btn-success { background: var(--success); }
    </style>
</head>
<body>
    <div class="container">
        <h1>EarnFlux Admin Dashboard</h1>

        <section id="usersSection">
            <h2>Users</h2>
            <table id="usersTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Username</th>
                        <th>Balance</th>
                        <th>Earned</th>
                        <th>Tasks Done</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="usersTableBody">
                    <!-- User data will be loaded here -->
                </tbody>
            </table>
        </section>

        <section id="withdrawalsSection">
            <h2>Withdrawals</h2>
            <table id="withdrawalsTable">
                <thead>
                    <tr>
                        <th>User</th>
                        <th>TON Address</th>
                        <th>Points</th>
                        <th>TON Amount</th>
                        <th>Status</th>
                        <th>Date</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="withdrawalsTableBody">
                    <!-- Withdrawal data will be loaded here -->
                </tbody>
            </table>
        </section>

        <!-- Add sections for tasks, lucky codes, etc. -->

    </div>

    <script>
        // Firebase configuration (USE YOUR ACTUAL CONFIG)
        const firebaseConfig = {
            apiKey: "AIzaSyA3SqCHzN3kLj7DC8Cyu9OzxPFtIlyyii4",
            authDomain: "maneybux-clone.firebaseapp.com",
            projectId: "maneybux-clone",
            storageBucket: "maneybux-clone.firebasestorage.app",
            messagingSenderId: "153207109623",
            appId: "1:153207109623:web:4cd48633c49c2ba3c1a0f2"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // --- INSECURE ADMIN FUNCTIONS ---
        // IMPORTANT: This is for demonstration ONLY and MUST NOT be used in production.
        // It lacks any authentication and security.

        function formatNumber(num) {
            if (num === null || num === undefined) return '0';
            num = Number(num);
            if (num >= 1e3) return (num / 1e3).toFixed(1).replace(/\.0$/, '') + 'K';
            return num.toString();
        }

        function loadUsers() {
            const tbody = document.getElementById('usersTableBody');
            database.ref('users').on('value', snapshot => {
                tbody.innerHTML = '';
                snapshot.forEach(userSnapshot => {
                    const user = userSnapshot.val();
                    const row = tbody.insertRow();
                    row.innerHTML = `
                        <td>${user.id}</td>
                        <td>${user.username || 'N/A'}</td>
                        <td>${formatNumber(user.balance || 0)}</td>
                        <td>${formatNumber(user.totalEarned || 0)}</td>
                        <td>${formatNumber(user.tasksCompleted || 0)}</td>
                        <td>
                            <button class="btn btn-success" onclick="editUser('${userSnapshot.key}')">Edit</button>
                            <button class="btn btn-danger" onclick="deleteUser('${userSnapshot.key}')">Delete</button>
                        </td>
                    `;
                });
            });
        }

        function loadWithdrawals() {
            const tbody = document.getElementById('withdrawalsTableBody');
            database.ref('withdrawals').on('value', snapshot => {
                tbody.innerHTML = '';
                snapshot.forEach(withdrawalSnapshot => {
                    const withdrawal = withdrawalSnapshot.val();
                    const row = tbody.insertRow();
                    const statusClass = `status-${withdrawal.status}`; // Assuming you have these styles in your CSS
                    const statusText = withdrawal.status.charAt(0).toUpperCase() + withdrawal.status.slice(1);

                    row.innerHTML = `
                        <td>${withdrawal.username || withdrawal.userId}</td>
                        <td>${withdrawal.tonAddress}</td>
                        <td>${formatNumber(withdrawal.amount)}</td>
                        <td>${withdrawal.tonAmount.toFixed(8)} TON</td>
                        <td><span class="history-status ${statusClass}">${statusText}</span></td>
                        <td>${new Date(withdrawal.createdAt).toLocaleString()}</td>
                        <td>
                            <button class="btn btn-success" onclick="approveWithdrawal('${withdrawalSnapshot.key}')">Approve</button>
                            <button class="btn btn-danger" onclick="rejectWithdrawal('${withdrawalSnapshot.key}')">Reject</button>
                        </td>
                    `;
                });
            });
        }

        function approveWithdrawal(withdrawalId) {
            // !!! This is where you would integrate with TON to send funds.
            // This is highly complex and requires a backend.
            // For demonstration, we'll just mark it as approved.
            alert("Approving withdrawal requires backend logic and TON integration. Marking as approved for now.");
            database.ref(`withdrawals/${withdrawalId}`).update({ status: 'approved' })
                .then(() => console.log('Withdrawal approved'))
                .catch(error => console.error('Error approving withdrawal:', error));
        }

        function rejectWithdrawal(withdrawalId) {
            if (confirm('Are you sure you want to reject this withdrawal?')) {
                database.ref(`withdrawals/${withdrawalId}`).update({ status: 'rejected' })
                    .then(() => console.log('Withdrawal rejected'))
                    .catch(error => console.error('Error rejecting withdrawal:', error));
            }
        }

        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user? All their data will be lost!')) {
                database.ref(`users/${userId}`).remove()
                    .then(() => console.log('User deleted'))
                    .catch(error => console.error('Error deleting user:', error));
                // Also delete related data like userTasks, referrals if necessary
            }
        }

        function editUser(userId) {
            // This would involve showing a modal or form to edit user details
            alert("Editing user functionality not implemented in this demo.");
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // !! REMOVE THIS ALERT IN A REAL SCENARIO !!
            alert("WARNING: This admin dashboard is NOT SECURE and is for demonstration purposes ONLY. Do not use it for sensitive operations.");

            loadUsers();
            loadWithdrawals();
            // Load other sections as needed
        });

    </script>
</body>
</html>
